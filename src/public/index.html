<!DOCTYPE html>
<head>
  <title>webvisual</title>
  <meta name="viewport" charset="utf-8" content="width=device-width, initial-scale=1, user-scalable=yes, minimum-scale=0.3"/>
  <script src="components/webcomponentsjs/webcomponents.min.js"></script>
  <script src="components/jquery/dist/jquery.min.js"></script>
  <script src="components/underscore/underscore-min.js"></script>
  <link rel="import" href="components/polymer/polymer.html">
  <link rel="import" href="components/neon-animation/neon-animation.html">
  <link rel="import" href="elements/juelich-icon.html">
  <link rel="import" href="import-behaviours.html">
  <link rel="import" href="elements/pages/select-page.html">
  <link rel="import" href="elements/pages/loading-page.html">
  <link rel="import" href="elements/pages/main-page.html">
  <link rel="import" href="elements/data-socket-repeater.html"/>
</head>
<dom-module id="pages-element">
  <link href="css/index.css" type="text/css" rel="stylesheet"/>
  <style>
    :host {
      height: 100%;
      width: 100%;
    }
    #pages {
      height: 100%;
      width: 100%;
    }
  </style>
  <template>
    <neon-animated-pages id="pages" animate-initial-selection>
      <select-page available-labels="{{availableLabels}}" labels="{{labels}}" on-configset="_onConfigset"></select-page>
      <loading-page id="loadPage" status="{{status}}"></loading-page>
      <main-page id="mainPage" class="element-page" data="{{data}}" labels="{{labels}}" groups="{{groups}}"
        elected-element="{{selectedElement}}" max-total-lines="{{maxLines}}" interval="{{interval}}"></main-page>
    </neon-animated-pages>
    <data-socket-repeater id="datasocket"
      data="{{data}}" available-labels="{{availableLabels}}" labels="{{labels}}" max-total-lines="{{maxLines}}" interval="{{interval}}"
      groups="{{groups}}" on-dataloaded="_onLoaded" status="{{status}}">
    </data-socket-repeater>
  </template>
  <script>
    window.addEventListener('WebComponentsReady', function(e) {
      Polymer({
        is: 'pages-element',
        attached: function(){
          this.$.pages.set('selected', '0');
          // this.$.loadPage.playAnimation('entry');
        },
        _onConfigset: function() {
          this.$.datasocket.connect();
          this.start = new Date();
          this.$.pages.set('selected', '1');
        },
        _onLoaded: function() {
          this.$.mainPage.setSelectedGroup();
          var self = this;
          var wait = new Date() - this.start;
          this.set("status.time.lastStatus",new Date()); this.set("status.message", "loading...");
          wait = (wait < 3500) ? 3500 - wait : 0;
          this.async(function() {
            // this is a bug in webanimations and and animations with intervall
            self.$.loadPage.cancelAnimation();
            this.$.pages.set('selected', '2');
          },wait);
        }});
      });
  </script>
</dom-module>
<body class="fullbleed">
    <pages-element></pages-element>
</body>
