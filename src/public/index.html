<head>
  <title>webvisual</title>
  <!-- Meta-Tag: Set the viewport-->
  <meta name="viewport" charset="utf-8" content="width=device-width, initial-scale=1, user-scalable=yes"/>

  <!-- Web-Components -->
  <script src="components/webcomponentsjs/webcomponents.min.js"></script>

  <script>
    // window.Polymer = window.Polymer || {};
    // window.Polymer.dom = 'shady';
  </script>

  <!-- Imported Elements and Scripts -->
  <link rel="import" href="imports.html"/>

</head>

<body unresolved>

  <template is="dom-bind" id="autobind-template">

  <socket-repeater id="datasocket" do-append="true" last-data="{{data}}" max-total-lines="{{max-lines}}" groups="{{groups}}"></socket-repeater>

  <paper-drawer-panel force-narrow="true">

    <!-- SIDEMENU -->

    <paper-header-panel drawer id="drawerPanel">
      <iron-selector selected="0" selectable="paper-button.sidemenu">

        <!-- Page Routing -->
        <paper-button collapse-id="pageview" class="sidemenu" onclick="toggleCollapse(this)">
          <iron-icon icon="pageview"></iron-icon>Anzeige
        </paper-button>

          <iron-collapse class="sidemenu collapse pageview">
            <section class="collapse-content">

              <iron-selector selected="0">
                <paper-button><iron-icon icon="view-module"></iron-icon>Ãœbersicht</paper-button>
                <paper-button><iron-icon icon="view-list"></iron-icon>Tabelle</paper-button>
                <paper-button><iron-icon icon="assessment"></iron-icon>Graphen</paper-button>
              </iron-selector>

            </section>
          </iron-collapse>

        <!-- Main Settings -->

        <paper-button collapse-id="settings" class="sidemenu" onclick="toggleCollapse(this)">
          <iron-icon icon="settings"></iron-icon>Einstellungen
        </paper-button>

          <iron-collapse class="sidemenu collapse settings">
            <section class="collapse-content">
              <paper-button disabled collapse-id="language" class="sidemenu" onclick="toggleCollapse(this)">
                <iron-icon icon="language"></iron-icon>Sprachauswahl
              </paper-button>
                <iron-collapse class="sidemenu collapse language">
                  <paper-tabs id="language" selected="1">
                    <paper-tab>en</paper-tab>
                    <paper-tab>de</paper-tab>
                    <paper-tab>fr</paper-tab>
                    <paper-tab>es</paper-tab>
                    <paper-tab>ru</paper-tab>
                  </paper-tabs>
                </iron-collapse>

              <paper-item>
                  <iron-icon icon="invert-colors"></iron-icon>
                  <span class="flex-3">Farbschema</span>
                  <paper-toggle-button class="flex" id="color-schema" on-change="changeTheme"></paper-toggle-button>
              </paper-item>

              <paper-item>
                <iron-icon icon="editor:format-line-spacing"></iron-icon>
                <number-input id="maxLineInput" value="{{max-lines}}"></number-input>
              </paper-item>

            </section>
          </iron-collapse>

      </iron-selector>

        <!-- Log-File -->

        <paper-button dialog-id="log" dialog-class="sidemenu" ajax class="sidemenu" onclick="openDialog(this)">
          <iron-icon icon="history"></iron-icon>Log
        </paper-button>

        <!-- Informations -->

        <paper-button collapse-id="information" class="sidemenu" onclick="toggleCollapse(this)">
          <iron-icon icon="description"></iron-icon>Informationen
        </paper-button>

          <iron-collapse class="sidemenu collapse information">
            <section class="collapse-content">
              <paper-button dialog-id="data" dialog-class="sidemenu" ajax class="sidemenu" onclick="openDialog(this)">
                <iron-icon icon="receipt"></iron-icon>Data-File
              </paper-button>
            </section>
          </iron-collapse>

    </paper-header-panel>


    <!-- MAIN VIEW -->
    <paper-header-panel main id="mainPanel" on-content-scroll="scrollPage">

      <!-- Toolbar -->
      <paper-toolbar id="mainToolbar">

        <!-- Upper Part -->
        <section id="header" class="horizontal layout">

          <!-- Sidemenu Button -->
          <paper-icon-button icon="menu" class="mainmenu" paper-drawer-toggle></paper-icon-button>

          <!-- Logo -->
          <logo-element></logo-element>

          <div class="flex"></div>

          <!-- Sidemenu Button -->
          <paper-icon-button icon="social:person-outline" id="identity" class="mainmenu" dialog-id="Login" dialog-class="mainmenu" onclick="openDialog(this)"></paper-icon-button>

        </section>

        <!-- Lower Part (Collapsible) -->
        <section id="lower" flex horizontal layout>
          TODO: add costum content object
        </section>
      </paper-toolbar>


      <!-- MAIN CONTENT -->
      <section id="main" class="vertical layout center">
        <section id="main" class="horizontal layout">

          <dropdown-selector items="[[groups.id]]" label="id" value-for-all="all"></dropdown-selector>
          <dropdown-selector items="[[groups.roomNr]]" label="Raumnummer"></dropdown-selector>
          <dropdown-selector items="[[groups.room]]" label="Raum"></dropdown-selector>
          <dropdown-selector items="[[groups.kind]]" label="Art"></dropdown-selector>
          <dropdown-selector items="[[groups.method]]" label="Methode"></dropdown-selector>
        </section>

        <!-- Page Option Button -->
        <paper-fab mini icon="extension" dialog-id="page1" dialog-class="submenu" id="extension" onclick="openDialog(this)"></paper-fab>

        <!-- Page -->
        <table-page id="element-page" data="{{data}}" r="{{test}}"><table-page>

      </section>

    </paper-header-panel>
  </paper-drawer-panel>


  <!-- Dialogs -->

    <!-- Log-in -->
  <paper-dialog class="mainmenu" entry-animation="scale-up-animation" exit-animation="fade-out-animation">
    <h2 class="dialog-title" horizontal layout>Login</h2>
    <section class="dialog-section" vertical layout center>
      <paper-input label="Benutzername"></paper-input>
      <paper-input label="Passwort" type="password"></paper-input>
    </section>
    <div class="buttons">
      <paper-button dialog-dismiss><iron-icon icon="close"></iron-icon>abbrechen</paper-button>
      <paper-button dialog-confirm><iron-icon icon="check"></iron-icon>anmelden</paper-button>
    </div>
  </paper-dialog>

    <!-- Page-Options -->
  <paper-dialog class="submenu" onclick="insertTest()" entry-animation="fade-in-animation" exit-animation="fade-out-animation">
    <paper-dialog-scrollable></paper-dialog-scrollable>
  </paper-dialog>

    <!-- Files -->

    <iron-ajax id="ajaxElement" auto url=""
        params=''
        handle-as="text" last-response="{{ajaxLogResponse}}"></iron-ajax>

    <paper-dialog class="sidemenu" entry-animation="scale-up-animation" exit-animation="fade-out-animation">
      <h2 class="dialog-title"></h2>
      <paper-dialog-scrollable>[[ajaxLogResponse]]</paper-dialog-scrollable>
      <div class="buttons">
        <paper-button disabled><iron-icon icon="mail"></iron-icon>Send</paper-button>
        <paper-button disabled><iron-icon icon="print"></iron-icon>Print</paper-button>
        <paper-button onclick="document.getElementById('ajaxElement').generateRequest()"><iron-icon icon="refresh"></iron-icon>Reload</paper-button>
        <paper-button dialog-confirm><iron-icon icon="check"></iron-icon>OK</paper-button>
      </div>
    </paper-dialog>

  </template>
</body>

<script>

  window.addEventListener('WebComponentsReady', function(e) {
    var template = document.querySelector('#autobind-template');
    var mainContainer = document.querySelector('div#mainContainer');
    var colorschema = "light";
    template.scrollPage = function() {
      if (mainContainer.scrollTop + mainContainer.offsetHeight >= mainContainer.scrollHeight) {
        var page = document.getElementById('element-page');
        page.scrollHandler(); // for each page-element should be a scrollHandler
      }
    };
    template.changeTheme = function(){
      if(colorschema == "dark") {
        $('*').removeClass("dark");
        colorschema = "light";
      }
      else {
        $('*').addClass("dark");
        colorschema = "dark";
      }
    }
  });

  function lift(){
    $('paper-material').attr('elevation','5');
  }

  function expand(){
    $('paper-toolbar').css('height','10em');
    $('paper-material.submenu').addClass("active");
  }

  function insertTest(){
    $('table-page').css('background','orange');
    $.get( "/data", function( response ) {
      $("body").css("--default-primary-color","red");
      $('paper-dialog.submenu paper-dialog-scrollable').text(response);
    });
  }

  function enable(){
    $('paper-fab').attr("disabled", false);

    $.get( "/data", function( response ) {
      $('.inner').text("<p>"+response+"</p>");
    });
  }

  function toggleCollapse(elem){
    var button = elem;
    while (!button.hasAttribute('collapse-id') && button !== document.body) {
      button = button.parentElement;
    }

    if (!button.hasAttribute('collapse-id')) {
      return;
    }

    var id = button.getAttribute('collapse-id');
    var collapse = document.querySelector('iron-collapse.'+id);

    if (collapse) {
      collapse.toggle();
    }
  }
  function openDialog(elem){
    var button = elem;
    while (!button.hasAttribute('dialog-id') && button !== document.body) {
      button = button.parentElement;
    }

    if (!button.hasAttribute('dialog-id') || !button.hasAttribute('dialog-class')) {
      return;
    }

    var id = button.getAttribute('dialog-id');
    var className = button.getAttribute('dialog-class');
    var aj = button.getAttribute('ajax');
    var dialog = document.querySelector('paper-dialog.'+className);

    $('paper-dialog.'+className+' .dialog-title').text(id);
    if (typeof aj === 'string')
      $('iron-ajax').attr('url','/'+id);

    if (dialog) {
      dialog.open();
    }
  }
</script>
