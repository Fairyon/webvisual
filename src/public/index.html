<!DOCTYPE html>
<head>
  <title>webvisual</title>
  <meta name="viewport" charset="utf-8" content="width=device-width, initial-scale=1, user-scalable=yes, minimum-scale=0.3"/>
  <script src="components/webcomponentsjs/webcomponents.min.js"></script>
  <script src="components/jquery/dist/jquery.min.js"></script>
  <script src="components/underscore/underscore-min.js"></script>
  <link rel="import" href="components/polymer/polymer.html">

  <link rel="import" href="elements/data-socket-repeater.html"/>
  <link rel="import" href="components/neon-animation/neon-animation.html">
  <link rel="import" href="elements/juelich-icon.html">
  <link rel="import" href="import-behaviours.html">
  <link rel="import" href="elements/pages/select-page.html">
  <link rel="import" href="elements/pages/loading-page.html">
  <link rel="import" href="elements/pages/main-page.html">
</head>
<dom-module id="pages-element">
  <link href="css/index.css" type="text/css" rel="stylesheet"/>
  <style>
    :host {
      height: 100%;
      width: 100%;
      background: #BBBBBB;
    }
    :host[dark] {
      background: #666666;
    }
    #pages {
      height: 100%;
      width: 100%;
    }
  </style>
  <template>
    <data-socket-repeater id="datasocket"
      data="{{data}}" exceeding="{{exceeding}}" is-exceeding="{{isExceeding}}" available-labels="{{availableLabels}}" labels="{{labels}}" max-total-lines="{{maxLines}}" interval="{{interval}}"
      groups="{{groups}}" status="{{status}}">
    </data-socket-repeater>
    <neon-animated-pages id="pages" animate-initial-selection>
      <select-page id="selectPage" available-labels="[[availableLabels]]" labels="{{labels}}"></select-page>
      <loading-page id="loadPage" status="{{status}}"></loading-page>
      <main-page id="mainPage" data="[[data]]" exceeding="[[exceeding]]" is-exceeding="[[isExceeding]]" labels="[[labels]]" groups="[[groups]]" max-total-lines="{{maxLines}}" interval="{{interval}}" always-show-tabs></main-page>
    </neon-animated-pages>
  </template>
  <script>
    window.addEventListener('WebComponentsReady', function(e) {
      Polymer({
        is: 'pages-element',
        attached: function(){
          this.$.pages.set('selected', '0');
          this.$.selectPage.$.labelsCookie.load();
          // this.$.loadPage.playAnimation('entry');
        },
        _onConfigset: function() {
          this.$.datasocket.opened = false;
          this.$.datasocket.connect();
          this.start = new Date();
          this.$.pages.set('selected', '1');
        },
        _onConfigreset: function() {
          this.$.datasocket.connect();
        },
        _onLoaded: function(e) {
          this.$.mainPage.setSelectedGroup();
          var self = this;
          var wait = new Date() - this.start;
          this.set("status.time.lastStatus",new Date()); this.set("status.message", "loading...");
          wait = (wait < 3000) ? 3000 - wait : 0;
          this.async(function() {
            // this is a bug in webanimations and and animations with intervall
              self.$.loadPage.cancelAnimation();
              self.$.pages.set('selected', '2');
          },wait);
        },
        _onRestart: function() {
          if (this.availableLabels.length != 1) {
            this.$.pages.set('selected', '0');
            this.$.selectPage.$.logo.style.visibility = "visible";
            this.$.selectPage.$.labelWindow.open();
          }
        },

        listeners: {
          "restart": "_onRestart",
          "loaded": "_onLoaded",
          "configset": "_onConfigset",
          "reconnect": "_onConfigreset"
        }
      });
    });
  </script>
</dom-module>
<style>
body {
  height: 100%;
  width: 100%;
  background: #BBBBBB;
}
body[dark] {
  background: #666666;
}
</style>
<body>
    <pages-element></pages-element>
</body>
