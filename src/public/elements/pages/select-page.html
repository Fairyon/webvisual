<dom-module id="select-page">
  <style>
    :host {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: var(--bright-text-color);
    }
    :host[dark] {
      color: var(--highlight-color);
    }
    section#background {
      @apply(--background);
      background: var(--primary-color-background);
      z-index: 95;
      box-shadow: 0 4px 5px 0 rgba(0, 0, 0, 0.14),
                  0 1px 10px 0 rgba(0, 0, 0, 0.12),
                  0 2px 4px -1px rgba(0, 0, 0, 0.4);
    }
    section#background[dark] {
      background: var(--dark-primary-color);
    }
    section#mainContent {
      box-sizing: border-box;
      display: block;
      border: none;
      outline: none;
      width: auto;
      height: auto;
      padding: 1.5em;
      z-index: 100;
    }
    section.title {
      font-size: 2em;
      line-height: normal;
      margin: 0.67em 0em;
      text-align: center;
    }
    section#select {
      font-family: Fira Sans Light;
      font-size: 1em;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: currentColor;
    }
    iron-selector#labelSelector {
      color: currentColor;
    }

    iron-selector#labelSelector ::content paper-radio-button  {
      font-size: 1em;
      padding: 0em;
      padding-top: 1.5em;
      float: left;
      clear: both;
    }

    span {
      font-size: 1.2em;
      padding: 1em 1em 0.75em 1em;
    }
    paper-button#submitButton {
      margin-left: auto;
      margin-top: 3em;
      border-style: solid;
      border-width: thin;
    }
    paper-button#submitButton iron-icon {
      margin: 0em 0.75em 0em 0em;
      z-index: 10;
    }

    paper-button#submitButton:hover {
      background: linear-gradient(to bottom, rgba(255,255,255,0.02) 5%,rgba(255,255,255,0.10) 40%);
    }
  </style>

  <template>

    <section id="background"></section>
    <section id="mainContent">
      <section class="title">Auswahl des Messraums</section>
      <section id="select">
        <span>verf√ºgbar sind:</span>
        <iron-selector id="labelSelector" selected-values="[[selectedLabels]]" on-iron-select="_disableButton" on-iron-deselect="_disableButton" multi attr-for-selected="label" selected-attribute="checked">
          <content></content>
        </iron-selector>
        <paper-button id="submitButton" disabled raised="[[notSelected]]" on-click="_onSubmit"><iron-icon id="logo" icon="juelich:logo"></iron-icon>Verbinden</paper-button>
      </section>
    </section>

    <cookie-element id="labelsCookie" name="selected-label"></cookie-element>
  </template>

  <script>

  Polymer({
      is: 'select-page',

      behaviors: [Polymer.NeonSharedElementAnimatableBehavior, Polymer.NeonAnimationRunnerBehavior],

      properties: {
        selectedLabels: {
          type: Array,
          value: function() { return [];},
          notify: true
        },
        sharedElements: {
          type: Object,
          value: function() {
            return {
              'herologo': this.$.logo
            }
          }
        },
        animationConfig: {
          value: function() {
            return {
              'entry': [
                {
                  name: 'fade-in-animation',
                  node: this.$.background,
                  timing: {
                    duration: 1000,
                    delay: 0,
                    easing: 'ease'
                  }
                },
                {
                  name: 'scale-up-animation',
                  node: this.$.mainContent,
                  timing: {
                    duration: 500,
                    delay: 0,
                    easing: 'ease'
                  }
                }
              ],
              'exit': [
                {
                  name: 'hero-animation',
                  id: 'herologo',
                  fromPage: this,
                },
                {
                  name: 'slide-up-animation',
                  node: this.$.background,
                  timing: {
                    duration: 500,
                    delay: 0,
                    easing: 'ease'
                  }
                },
                {
                  name: 'fade-out-animation',
                  node: this.$.mainContent,
                  timing: {
                    duration: 300,
                    delay: 0,
                    easing: 'linear'
                  }
                }
              ]
            }
          }
        }
      },

      attached: function() {
        this._setSelected(this.$.labelsCookie.load());
      },

      _setSelected: function(labels) {
        if (!labels) return;
        var labelSelector = this.$.labelSelector;
        for (var i in labels) {
          if (Labels.indexOf(labels[i]) !== -1)
            labelSelector.select(labels[i]);
        }
      },

      _disableButton: function() {
        if (this.selectedLabels.length === 0)
          this.$.submitButton.setAttribute('disabled', true);
        else
          this.$.submitButton.removeAttribute('disabled');
      },

      _onSubmit: function() {
        // save the label
        this.$.labelsCookie.save(this.selectedLabels);
        // connect the datasocket
        connect(this.selectedLabels);
        // select the MainPage
        PageSelector.select("1");
        // Hide in MianPage the non selected label-related Elements
        MainPage.dissemblePanels(this.selectedLabels);
        // Set Window title to selectedLabels
        document.title = ((this.selectedLabels.length > 0) ? this.selectedLabels.join(', ') : this.selectedLabels.toString());
      }
    });
  </script>

</dom-module>
