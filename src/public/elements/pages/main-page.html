<!-- Custom-Style-Element -->
<link rel="import" href="../../components/iron-selector/iron-selector.html">
<link rel="import" href="../../components/iron-collapse/iron-collapse.html">
<!-- <link rel="import" href="../../components/iron-flex-layout/iron-flex-layout.html"> -->
<!-- <link rel="import" href="../../components/paper-styles/paper-styles-classes.html"> -->
<link rel="import" href="../../components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../../components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../../components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../components/paper-item/paper-item.html">
<link rel="import" href="../../components/paper-input/paper-input.html">
<link rel="import" href="../../components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../components/paper-button/paper-button.html">
<link rel="import" href="../../components/paper-fab/paper-fab.html">
<link rel="import" href="../../components/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="../../components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../components/paper-dialog-scrollable/paper-dialog-scrollable.html">
<link rel="import" href="../../css/app-theme.html">

<link rel="import" href="../main-toolbar.html"/
<link rel="import" href="../logo-element.html"/>
<link rel="import" href="../sign-element.html"/>
<link rel="import" href="../table-element.html"/>
<link rel="import" href="../post-card.html"/>

<!-- <link rel="import" href="../line-chart.html"/> -->
<!-- <link rel="import" href="../../components/leaflet-map/leaflet-map.html"> -->

<dom-module id="main-page">
  <!-- CSS Style -->
  <link href="../../css/index.css" type="text/css" rel="stylesheet"/>
  <link href="../../css/page.css" type="text/css" rel="stylesheet"/>
  <style>
    :host{
      display: flex;
      flex-direction: column;
    }
    section#mainContent {
      align-self: stretch;
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      /*background: #6642BF;*/
    }
    @media all and (min-width: 0px) and (max-width: 600px) {
      section#mainContent {
        display: block;
      }
    }
    logo-element {
      position: fixed;
      top: 10px;
      left: 76px;
      height: 44px;
      color: #f1f1f1;
      z-index: 10;
    }
    /*logo-element[dark] {
      position: fixed;
      top: 10px;
      left: 76px;
      height: 44px;
      color: #A8CCDB;
    }*/
    main-toolbar {
      /*z-index: 5;*/
    }
    paper-drawer-panel {
      position: relative;
      flex: 1;
    }
  </style>

  <template>

    <logo-element id="logo"></logo-element>
    <main-toolbar id="toolbar" class="paper-header">
      <paper-icon-button icon="menu" class="header" on-click="togglePanel"></paper-icon-button>
    </main-toolbar>

  <paper-drawer-panel id="mainView" force-narrow="true">
    <!-- SIDEMENU -->
    <paper-header-panel drawer id="drawerPanel">
      <iron-selector multi selectable="paper-button.sidemenu.collapsable">

        <!-- <paper-button collapse-id="pageview" class="sidemenu collapsable" on-tap="toggleCollapse">
          <iron-icon icon="pageview"></iron-icon>
          <span class="flex">Anzeige</span>
          <iron-icon icon="arrow-drop-down" class="collapse-arrow right-icon" id="pageview"></iron-icon>
        </paper-button> -->
          <!-- <iron-collapse class="sidemenu collapse pageview">
            <section class="collapse-content">
              <iron-selector selected="0">
                <paper-button class="sidemenu"><iron-icon icon="view-module"></iron-icon>Ãœbersicht</paper-button>
                <paper-button class="sidemenu"><iron-icon icon="view-list"></iron-icon>Tabelle</paper-button>
                <paper-button class="sidemenu"><iron-icon icon="assessment"></iron-icon>Graphen</paper-button>
              </iron-selector>
            </section>
          </iron-collapse> -->

        <paper-button collapse-id="settings" class="sidemenu collapsable" on-tap="toggleCollapse">
          <iron-icon icon="settings"></iron-icon>
          <span class="flex">Einstellungen</span>
          <iron-icon icon="arrow-drop-down" class="collapse-arrow right-icon" id="settings"></iron-icon>
        </paper-button>

          <iron-collapse class="sidemenu collapse settings">
            <section class="collapse-content">
              <paper-button collapse-id="language" class="sidemenu" on-tap="toggleCollapse">
                <iron-icon icon="language"></iron-icon>
                <span class="flex">Sprachauswahl</span>
                <iron-icon icon="arrow-drop-down" class="collapse-arrow right-icon" id="language"></iron-icon>
              </paper-button>
                <iron-collapse class="sidemenu collapse language">
                  <paper-tabs id="language" selected="1">
                    <paper-tab>en</paper-tab>
                    <paper-tab>de</paper-tab>
                    <paper-tab>fr</paper-tab>
                    <paper-tab>es</paper-tab>
                    <paper-tab>ru</paper-tab>
                  </paper-tabs>
                </iron-collapse>

              <paper-item>
                  <iron-icon icon="invert-colors"></iron-icon>
                  <span class="flex-3">Farbschema</span>
                  <paper-toggle-button class="flex" id="colorschema" on-change="changeTheme"></paper-toggle-button>
              </paper-item>

              <paper-item>
                <paper-input label="Anzahl an Messpunkten" value="{{maxLines}}" min="1" type="number" inputmode="number" step="1" auto-validate required prevent-invalid-input>
                  <iron-icon prefix icon="editor:format-line-spacing"></iron-icon>
                </paper-input>
              </paper-item>
              <paper-item>
                <paper-input label="Aktualisierungsintervall" value="{{interval}}" min="0" always-float type="number" inputmode="number" step="0.1" auto-validate required prevent-invalid-input>
                  <iron-icon prefix icon="image:timelapse"></iron-icon>
                  <div suffix style="font-size:0.6em">Sekunden</div>
                </paper-input>
              </paper-item>

            </section>
          </iron-collapse>

        <paper-button dialog-id="log" dialog-class="sidemenu" ajax class="sidemenu" on-tap="openDialog">
          <iron-icon icon="history"></iron-icon>
          <span class="flex">Log</span>
        </paper-button>

        <paper-button collapse-id="information" class="sidemenu collapsable" on-tap="toggleCollapse">
          <iron-icon icon="description"></iron-icon>
          <span class="flex">Informationen</span>
          <iron-icon icon="arrow-drop-down" class="collapse-arrow right-icon" id="information"></iron-icon>
        </paper-button>

          <iron-collapse class="sidemenu collapse information">
            <section class="collapse-content">
              <paper-button dialog-id="data" dialog-class="sidemenu" ajax class="sidemenu" on-tap="openDialog">
                <iron-icon icon="receipt"></iron-icon>
                <span class="flex">Daten</span>
              </paper-button>
              <paper-item class="date">
                <iron-icon icon="swap-vert"></iron-icon>
                <span class="flex">letzte Nachricht</span>
                <span class="italic">{{computeDate(lastMessage)}}</span>
              </paper-item>
              <paper-item class="date">
                <iron-icon icon="remove-circle-outline"></iron-icon>
                <span class="flex">letzte Fehlverbindung</span>
                <span class="italic">{{computeDate(lastError)}}</span>
              </paper-item>
              <paper-item class="date">
                <iron-icon icon="warning"></iron-icon>
                <span class="flex">letzte fehlerhafte Nachricht</span>
                <span class="italic">{{computeDate(lastMistake)}}</span>
              </paper-item>
            </section>
          </iron-collapse>

        <paper-button class="sidemenu" dialog-id="Login" dialog-class="mainmenu" on-tap="openDialog">
          <iron-icon icon="social:person-outline"></iron-icon>
          <span class="flex">Login</span>
        </paper-button>
      </iron-selector>
    </paper-header-panel>

    <!-- MAIN VIEW -->
    <paper-header-panel main>



      <section id="mainContent" class="fit">
        <!-- <div class="r3">
          Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
        </div> -->
        <template id="groupingtemplate" is="dom-repeat" items="{{selectedGroup}}" as="groupedItem" sort="sortGroup" delay="200">
          <post-card class="group" headline="{{groupedItem.group}}" on-click="setSelectedElement">

            <template is="dom-repeat" items="{{data}}" as="element">
              <template is="dom-if" if="{{groupElements(element,groupedItem)}}" restamp>
                <section class="card" on-click="setSelectedElement">

                    <sign-element element="{{element}}"></sign-element>
                    <section class="caption" id="{{element.id}}">
                      <span id="kind">{{element.kind}}</span>
                      <span id="method">{{element.method}}</span>
                      <span id="room">{{element.room}}</span>
                      <span id="roomNr">{{element.roomNr}}</span>
                    </section>

                </section>
              </template>
            </template>
          </post-card>
        </template>

        <paper-fab mini icon="extension" id="extension" on-click="openOption"></paper-fab>

      </section>

      <!-- <pages-element main class="element-page" data="{{data}}" groups="{{groups}}" on-drawer-toggle-pressed="toggleDrawer"></pages-element> -->
    </paper-header-panel>
  </paper-drawer-panel>

  <!-- Dialogs -->

  <!-- Page-Options -->
  <!-- <paper-dialog id="optionDialog" entry-animation="slide-to-up-animation" exit-animation="slide-to-down-animation">
    <section class="horizontal layout">
      <post-card headline="Gruppieren nach">
        <paper-menu attr-for-selected="id" selected="{{groupBy}}">
          <template is="dom-repeat" items="{{keys}}" as="key">
            <paper-item id="{{key}}">{{key}}</paper-item>
          </template>
        </paper-menu>
      </post-card>
    </section>
  </paper-dialog> -->

    <!-- Log-in -->
  <!-- <paper-dialog class="mainmenu" entry-animation="scale-up-animation" exit-animation="fade-out-animation">
    <h2 class="dialog-title">Login</h2>
    <section class="dialog-section" vertical layout center>
      <paper-input label="Benutzername"></paper-input>
      <paper-input label="Passwort" type="password"></paper-input>
    </section>
    <div class="buttons">
      <paper-button dialog-dismiss><iron-icon icon="close"></iron-icon>abbrechen</paper-button>
      <paper-button dialog-confirm><iron-icon icon="check"></iron-icon>anmelden</paper-button>
    </div>
  </paper-dialog> -->

    <!-- Files -->

    <!-- <iron-ajax id="ajaxElement" auto url=""
        params=''
        handle-as="text" last-response="{{ajaxLogResponse}}"></iron-ajax>

    <paper-dialog class="sidemenu" entry-animation="scale-up-animation" exit-animation="fade-out-animation">
      <h2 class="dialog-title"></h2>
      <paper-dialog-scrollable>[[ajaxLogResponse]]</paper-dialog-scrollable>
      <div class="buttons">
        <paper-button disabled><iron-icon icon="mail"></iron-icon>Send</paper-button>
        <paper-button disabled><iron-icon icon="print"></iron-icon>Print</paper-button>
        <paper-button onclick="document.querySelector('iron-ajax').generateRequest()"><iron-icon icon="refresh"></iron-icon>Reload</paper-button>
        <paper-button dialog-confirm><iron-icon icon="check"></iron-icon>OK</paper-button>
      </div>
    </paper-dialog> -->

  </template>
  <script>

    Polymer({
      is: 'main-page',

      behaviors: [ScrollBehavior, DataBehavior, LanguageBehavior, PageBehavior, Polymer.NeonSharedElementAnimatableBehavior],

      properties: {
        sharedElements: {
          value: function() {
            return {
              'herologo': this.$.logo
            }
          }
        },
        animationConfig: {
          value: function() {
            return {
              'entry': [
                {
                  name: 'hero-animation',
                  id: 'herologo',
                  toPage: this,
                }
              ]
            }
          }
        },
        colorschema: {
          type: String,
          value: "light"
        }
      },

      setSelectedElement: function(e) {
        if(e) {
          var item = e.model.element;
          var icol = Polymer.Collection.get(this.data);
          var key = icol.getKey(item);
          this.selectedElement = item;
          this.linkPaths('selectedElement', 'data.' + key);
          this.notifyPath('selectedElement.values', this.selectedElement.values);
          this.fire('selectevent');
        }
      },

      changeTheme: function(){
        if(this.colorschema == "dark") {
          $('*').removeAttr("dark");
          this.colorschema = "light";
        }
        else {
          $('*').attr("dark",true);
          this.colorschema = "dark";
        }
      },

      togglePanel: function(){
        this.$.mainView.togglePanel();
      },

      toggleCollapse: function(e){
        var button = e.currentTarget;
        if (!button.hasAttribute('collapse-id')) {
          return;
        }
        var id = button.getAttribute('collapse-id');
        var collapse = document.querySelector('iron-collapse.'+id);
        var iconbutton = document.querySelector('iron-icon.collapse-arrow#'+id);
        if (collapse) {
          collapse.toggle();
          if (iconbutton) {
            if (iconbutton.getAttribute('icon') == 'arrow-drop-down')
              iconbutton.setAttribute('icon','arrow-drop-up');
            else
              iconbutton.setAttribute('icon','arrow-drop-down');
          }
        }
      },

      openDialog: function(e){
        var button = e.currentTarget;
        if (!button.hasAttribute('dialog-id') || !button.hasAttribute('dialog-class')) {
          return;
        }
        var id = button.getAttribute('dialog-id');
        var className = button.getAttribute('dialog-class');
        var aj = button.getAttribute('ajax');
        var dialog = document.querySelector('paper-dialog.'+className);
        $('paper-dialog.'+className+' .dialog-title').text(id);
        if (typeof aj === 'string')
          $('iron-ajax').attr('url','/'+id);
        if (dialog) {
          dialog.open();
        }
      }
    });

  </script>

</dom-module>
