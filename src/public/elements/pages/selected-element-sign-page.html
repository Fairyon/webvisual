<link href="../../css/page.css" type="text/css" rel="stylesheet"/>
<dom-module id="selected-element-sign-page">
  <style>
    section#mainContent {
      height: 70vh;
    }
    @media all and (min-width: 0px) and (max-width: 600px) {
      section#mainContent {
        display: block;
      }
    }
    section#lowerToolbar {
      display: flex;
      /*overflow-x: auto;*/
      background: linear-gradient(180deg, rgba(255, 255, 255, 0), rgba(230, 230, 230, 0.15), rgba(255, 255, 255, 0));
    }
    section#lowerToolbar > #selectedElementSign {
      width: calc(32vh - 80px);
      min-width: 6em;
      max-width: 30vw;
      border-radius: 1px 0px 0px 2px;
    }
    section#lowerToolbar > * {
      box-shadow: inset 0px 5px 6px -3px rgba(0, 0, 0, 0.4);
    }
    section#selectedElementCaption {
      width: 20vw;
      min-width: 3em;
      max-width: 9em;
      position: relative;
      color: #1f1f1f;
      background: white;
      border-radius: 0px 1px 2px 0px;
      padding: 1.5em;
      justify-content: center;
      line-height: 1.6;
    }
    section#selectedElementCaption.dark {
      background: #a8a8a8;
    }
    .selectedElement {
      font-size: calc(1.75vh + 0.25vw);
    }
    table-element#selectedElementTable{
      background: white;
      width: 30vw;
      min-width: 6em;
      max-width: 12em;
    }
    table-element#selectedElementTable.dark{
      background: #a8a8a8;
    }
    leaflet-map#selectedElementMap {
      position: relative;
      font-family: Roboto-Light-Condensed;
      min-width: 10em;
      width: 30vw;
    }
    leaflet-map#selectedElementMap:before {
      position: absolute;
      height: 6px;
      top: 0px;
      box-shadow: inset 0px 5px 6px -3px rgba(0, 0, 0, 0.4);
      content: "";
      width: 100%;
      left: 0px;
      right: 0px;
      z-index: 5;
    }
  </style>

  <template>

    <link href="../../css/page.css" type="text/css" rel="stylesheet"/>

    <main-toolbar id="toolbar" class="has-shadow paper-header" opened>
        <paper-icon-button icon="menu" class="mainmenu header" on-click="toggleDrawer"></paper-icon-button>
        <logo-element class="header"></logo-element>
        <paper-icon-button id="iconToggle" class="icon-toggle" icon="expand-less" on-click="_onClose"></paper-icon-button>
        <section id="lowerToolbar">
          <sign-element id="selectedElementSign" class="selectedElement" element="{{selectedElement}}" on-click="_onClose"></sign-element>
          <section id="selectedElementCaption" class="selectedElement caption">
            <span id="kind">{{selectedElement.kind}}</span>
            <span id="method">{{selectedElement.method}}</span>
            <span id="room">{{selectedElement.room}}</span>
            <span id="roomNr">{{selectedElement.roomNr}}</span>
          </section>
          <table-element id="selectedElementTable" class="selectedElement" element="{{selectedElement}}"></table-element>
          <!-- <line-chart id="selectedElementChart" element="{{selectedElement}}" fit></line-chart> -->
          <leaflet-map id="selectedElementMap" latitude="50.904" longitude="6.41041" zoom="18" no-inertia></leaflet-map>
        </section>
    </main-toolbar>

    <!-- Page Option Button -->
    <paper-fab mini icon="extension" id="extension" on-click="openOption"></paper-fab>
    <neon-animated-pages id="pages" selected="0">

    <section id="mainContent" class="page">
      <template id="groupingtemplate" is="dom-repeat" items="{{selectedGroup}}" as="groupedItem" sort="sortGroup" delay="200">
        <post-card class="group" headline="{{groupedItem.group}}">

          <template id="elementlist" is="dom-repeat" items="{{data}}" as="element">
            <template is="dom-if" if="{{groupElements(element,groupedItem)}}" restamp>
              <section class="card" on-click="setSelectedElement">

                  <sign-element element="{{element}}"></sign-element>
                  <section class="caption" id="{{element.id}}">
                    <span id="kind">{{element.kind}}</span>
                    <span id="method">{{element.method}}</span>
                    <span id="room">{{element.room}}</span>
                    <span id="roomNr">{{element.roomNr}}</span>
                  </section>

              </section>
            </template>
          </template>
        </post-card>
      </template>

    </section>

    <!-- Page-Options -->
    <paper-dialog id="optionDialog" entry-animation="slide-to-up-animation" exit-animation="slide-to-down-animation">
      <section class="horizontal layout">
        <post-card headline="Gruppieren nach">
          <paper-menu attr-for-selected="id" selected="{{groupBy}}">
            <template is="dom-repeat" items="{{keys}}" as="key">
              <paper-item id="{{key}}">{{key}}</paper-item>
            </template>
          </paper-menu>
        </post-card>
      </section>
    </paper-dialog>

  </template>

  <script>

    Polymer({
      is: 'selected-element-sign-page',

      behaviors: [ScrollBehavior, DataBehavior, LanguageBehavior, PageBehavior, Polymer.NeonSharedElementAnimatableBehavior],

      properties: {
        // sharedElements: {
        //   value: function() {
        //     return {
        //       'heroSign': this.$.selectedElementSign,
        //       'heroCaption': this.$.selectedElementCaption
        //     }
        //   }
        // },
        animationConfig: {
          value: function() {
            return {
              'entry': [
                {
                  name: 'slide-from-left-animation',
                  node: this.$.selectedElementSign,
                  timing: {
                    duration: 500
                  }
                },
                {
                  name: 'slide-from-left-animation',
                  node: this.$.selectedElementCaption,
                  timing: {
                    duration: 500
                  }
                },
                {
                  name: 'scale-up-animation',
                  node: this.$.selectedElementTable,
                  timing: {
                    duration: 500
                  }
                },
                {
                  name: 'scale-up-animation',
                  node: this.$.selectedElementMap,
                  timing: {
                    duration: 500
                  }
                }
              ],
              'exit': [ {
                  name: 'fade-out-animation',
                  node: this.$.lowerToolbar,
                  timing: {
                    duration: 500
                  }
                },
                {
                  name: 'fade-out-animation',
                  node: this.$.iconToggle,
                  timing: {
                    duration: 250
                  }
                },
                {
                  name: 'height-animation',
                  node: this.$.toolbar,
                  height: "64px",
                },
                {
                  name: 'slide-left-animation',
                  node: this.$.selectedElementSign,
                  timing: {
                    duration: 250
                  }
                },
                {
                  name: 'slide-left-animation',
                  node: this.$.selectedElementCaption,
                  timing: {
                    duration: 250
                  }
                }]
            }
          }
        },
        latitude: {
          type: Number,
          notify: true
        },
        longitude: {
          type: Number,
          notify: true
        },
        zoom: {
          type: Number,
          notify: true
        }
      },

      _onClose: function(opened){
        this.fire("deselectevent");
      },

      // _onNext: function(opened){
      //   this.fire("nextselectevent");
      // },

      setSelectedElement: function(e) {
        if (e){
          var item = e.model.element;
          if (this.selectedElement == item){
            this.unlinkPaths('selectedElement');
            this._onClose();
          }
          else {
            this.unlinkPaths('selectedElement');
            var icol = Polymer.Collection.get(this.data);
            var key = icol.getKey(item);
            this.selectedElement = item;
            this.linkPaths('selectedElement', 'data.' + key);
            // this._onNext();
          }
        }
      }

    });

  </script>

</dom-module>
