<dom-module id="list-element">
  <style>
    :host {
      position: relative;
      color: #f1f1f1;;
      overflow: hidden;
      display: flex;
      outline: none;
      font-family: Light;
      user-select: none;
      background: transparent;
      font-size: 1em;
      line-height: 1;
    }
    section#mainContent {
      display: inline-flex;
    }
    section#sign {
      cursor: pointer;
      position: relative;
      display: inline-flex;
    }
    section#sign.null {
      background: rgb(0, 202, 53); color: #f1f1f1;
    }
    section#sign.true {
      background: rgb(255, 21, 41); color: #f1f1f1;
    }
    section#sign.false {
      background: rgb(255, 20, 110); color: #f1f1f1;
    }
    section#sign.undefined {
      background: rgb(236, 249, 97); color: #1f1f1f;
    }
    section#sign[dark]{
      color: #d3d3d3;
    }
    section.actualValueSection {
      display: flex;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0), rgba(230, 230, 230, 0.2), rgba(255, 255, 255, 0));
      padding: 1em 1em 0.25em 1em;
      align-items: center;
      flex: 1;
      flex-direction: row;
      justify-content: center;
    }
    section.valueSection {
      font-size: 1.25em;
      font-style: normal;
    }
    section.unitSection {
      padding-left: 0.3em;
      font-size: 0.8em;
    }
    section.dateSection {
      font-family: Light;
      font-size: 0.6em;
      color: #5a5a5a;
    }
    section.lowerSection {
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: bottom;
      padding: 0.25em 0.75em 0.25em 0.75em;
      line-height: 1em;
    }
    section.caption {
      background: white;
      border-top: thin solid #BBBBBB;
      color: #1f1f1f;
      flex-direction: column;
      line-height: 1.4;
      min-height: 4.5em;
      display: flex;
      padding: 0.35em 0.65em 0.4em 0.6em;
    }
    section.caption[dark] {
      background: #a8a8a8;
      border-top: thin solid #606060;
      color: #1d1d1d;
    }
    iron-icon {
      --iron-icon-height: 1.75em;
      --iron-icon-width: 1.75em;
      color: currentColor;
      animation-name: exceed-animation;
      animation-duration: 2s;
      animation-timing-function: ease-in-out;
      animation-iteration-count: infinite;
    }
    @keyframes exceed-animation {
        0%   {transform: scale(1);}
        33%  {transform: scale(1.10);}
        100% {transform: scale(1);}
    }
    #ripple {
      color: #1d1d1d;
    }
  </style>
  <template>
    <section id="mainContent">

      <section id="sign" dark$="[[dark]]">
        <paper-ripple id="ripple"></paper-ripple>

        <section class="actualValueSection">
          <template is="dom-if" if="{{!element.isBoolean}}" restamp>
            <section class="valueSection">{{computeY(element.values.*,0)}}</section><section class="unitSection">[[element.unit]]</section>
          </template>
          <template is="dom-if" if="{{element.isBoolean}}" restamp>
            <section hidden$="{{!isExceeding}}">
              <iron-icon icon="error-outline"></iron-icon>
            </section>
          </template>
        </section>

        <template is="dom-if" if="{{showDate}}" restamp>
          <section class="lowerSection">
            <section class="dateSection">{{computeX(element.values.*,0)}}</section>
          </section>
        </template>
      </section>

      <template is="dom-if" if="{{showCaption}}" restamp>
        <section class="caption" dark$="[[dark]]">
          <template id="captiontemplate" is="dom-repeat" items="{{keys}}" as="key">
            <span id="[[key]]" style$="[[computeCaptionStyle(index)]]">{{getKey(key)}}</span>
          </template>
        </section>
      </template>

    </section>
  </template>

  <script>

    SignElement = Polymer({
      is: 'list-element',

      behaviors: [ElementBehavior],

      created: function(){
        this.exceedsStyle = {
          true:  "",
          false: "",
          none:  "",
          undef: ""
        };
      },

      properties: {
        showDate: {
          type: Boolean,
          value: true,
          reflectToAttribute: true
        },
        showCaption: {
          type: Boolean,
          value: true,
          reflectToAttribute: true
        },
        dark: {
          type: Boolean,
          value: false,
          reflectToAttribute: true
        }
      },

      // attached: function() {
      //   this.linkPaths("isExceeding", "element.isExceeding");
      //   this.notifyPath('isExceeding', this.element.isExceeding);
      // },

      observers: [
        "_handleExceeding(element.isExceeding)"
      ],

      _handleExceeding: function(value) {
        if (this.element && this.element.values) {
          this.isExceeding = value;
          this.$.sign.classList.remove('true');
          this.$.sign.classList.remove('false');
          this.$.sign.classList.remove('null');
          this.$.sign.classList.remove('undefined');
          this.$.sign.classList.add(this.element.values[0].exceeds);
        }
      }

    });
  </script>

</dom-module>
