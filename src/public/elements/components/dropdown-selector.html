<dom-module id="dropdown-selector">
  <template strip-whitespace>

  <style>
    :host {
      box-sizing: content-box;
      position: relative;
      display: inline-block;
      clear: both;
      float: left;
      outline: none;
      margin: 0.25em 0;
    }
    section#container {
      display: inline-flex;
      align-items: center;
      align-content: center;
      justify-content: flex-start;
      box-sizing: content-box;
      cursor: pointer;
      outline: none;
      border-bottom: 1px solid rgba(0,0,0, 0.12);
      padding: 0.75em 0.5em 0.25em;
    }

    label {
      position: absolute;
      pointer-events: none;
      left: 0.5em;
      top: 1.25em;
      line-height: normal;
      color: rgba(0, 0, 0, 0.26);
      transition: 0.2s ease all;
      -moz-transition: 0.2s ease all;
      -webkit-transition: 0.2s ease all;
    }

    section.focusline {
      background-color: var(--bright-primary-color);
      height: 2px;
      width: 5%;
      bottom: 0px;
      left: 45%;
      visibility: hidden;
      pointer-events: none;
      position: absolute;
      transition: 0.2s ease all;
      -moz-transition: 0.2s ease all;
      -webkit-transition: 0.2s ease
    }

    section#container:focus section.focusline {
      visibility: visible;
      width: 100%;
      left: 0;
    }

    label:not([float]) {
      color: currentColor;
      position: relative;
      float: left;
      left: auto;
      top: auto;
    }

    section#container.set label[float] {
      visibility: visible;
      left: 0.75em;
      top: 0.25em;
      font-size: 0.67em;
      color: var(--primary-color);
    }

    paper-ripple {
      color: var(--ripple-color, currentColor);
    }
  </style>

    <section id="container" on-tap="toggleIcon" tabindex='0'>
      <paper-ripple></paper-ripple>
      <label hidden="[[!label]]" float$="[[!hideSelected]]" for="container">[[label]]</label>
      <section hidden$="[[hideSelected]]">[[selected]]</section>
      <iron-icon id="arrow" class="right" icon="arrow-drop-down"></iron-icon>
      <section class="focusline"></section>
    </section>
    <dropdown-element id="dropdown" for="container" horizontal="[[horizontal]]">
      <content></content>
    </dropdown-element>
  </template>

  <script>
    Polymer({
      is: 'dropdown-selector',

      behaviors: [Polymer.IronSelectableBehavior],

      properties: {
        label: {
          type: String,
          value: ""
        },
        horizontal: {
          type: Boolean,
          value: false
        },
        value: {
          type: String,
          value: "",
          reflectToAttribute: true
        },
        toggles: {
          type: Boolean,
          value: false,
          reflectToAttribute: true
        },
        hideSelected: {
          type: Boolean,
          value: false,
          reflectToAttribute: true
        }
      },

      hostAttributes: {
        role: 'select',
        tabindex: '0'
      },

      listeners: {
        "iron-select": "_onSelect"
      },

      _onSelect: function() {
        this.value = this.selected;
        if (this.toggles === true) {
          this.listen(this.selectedItem, 'tap', 'deselect');
        }
        if (this.value === '') {
          this.$.container.classList.remove('set')
        } else {
          this.$.container.classList.add('set')
        }
        this.toggleIcon();
      },
      deselect: function(e) {
        this.unlisten(this.selectedItem, 'tap', 'deselect');
        this.selected = this.fallbackSelection;
        e.stopImmediatePropagation();
        this.$.dropdown.hide();
      },
      toggleIcon: function() {
        if (this.$.arrow.icon === 'arrow-drop-down')
          this.$.arrow.set('icon','arrow-drop-up');
        else
          this.$.arrow.set('icon','arrow-drop-down');
      }
    });
  </script>
</dom-module>
