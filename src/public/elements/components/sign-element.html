<link rel="import" href="../behaviors/element-behavior.html">
<link rel="import" href="../../components/paper-ripple/paper-ripple.html"/>
<link rel="import" href="../../components/paper-tooltip/paper-tooltip.html"/>
<link rel="import" href="../../components/iron-list/iron-list.html"/>

<dom-module id="sign-element">
  <style>
    :host {
      position: relative;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      outline: none;
      font-family: Fira Sans Light;
      font-weight: normal;
      -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;
      -webkit-touch-callout: none; -webkit-tap-highlight-color: rgba(0,0,0,0);
      background: transparent;
      font-size: 1em;
      line-height: 1;
      align-self: stretch;
      z-index: auto;
      color: #f1f1f1;
      border-radius: 2px 2px 2px 3px;
      border: none !important;
    }
    section#sign {
      border-top-left-radius: inherit; border-top-right-radius: inherit; border-bottom-left-radius: 0; border-bottom-right-radius: 0;
      cursor: pointer;
      box-shadow: inherit;
      position: relative;
      display: flex;
      flex-direction: column;
      min-height: 4em;
      min-width: 5em;
      padding-bottom: 0.25em;
      box-sizing: border-box;
      border-style: solid; border-width: thin;
      border-top-color: #B0B0B0;
      border-left-color: #B0B0B0;
      border-right-color: #B0B0B0;
      border-bottom-color: #BBB;
    }
    section#sign.null {
      background: #1BD939; color: #f1f1f1;
    }
    section#sign.true {
      background: #D91B1B; color: #f1f1f1;
    }
    section#sign.false {
      background: #920bad; color: #f1f1f1;
    }
    section#sign.undefined {
      background: #c3ab12; color: #1f1f1f;
    }
    section#sign[dark]{
      color: #d3d3d3;
      border-bottom-color: #888;
      border-top-color: #777;
      border-left-color: #777;
      border-right-color: #777;
    }
    section#actualValueSection {
      text-shadow: 0px 0px 1px #1f1f1f;
      display: flex;
      flex: 1;
      background: linear-gradient(180deg,rgba(255,255,255,0),rgba(230,230,230,0.2),rgba(255,255,255,0));
      padding: 0.25em;
      line-height: 1.5em;
      justify-content: center;
      align-items: center;
    }
    section#valueSection {
      font-size: 1.5em;
    }
    section#unitSection {
      margin-left: 0.25em;
      font-size: 0.8em;
    }
    section#dateSection {
      font-size: 0.6em;
      color: #606060;
      align-self: center;
    }
    section#caption {
      cursor: default;
      border-top-left-radius: 0; border-top-right-radius: 0; border-bottom-left-radius: inherit; border-bottom-right-radius: inherit;
      background: white;
      color: #1f1f1f;
      line-height: 1.5;
      padding: 0.25em 0.75em 0.5em 0.5em;
      display: inline-block;
      flex: 1 0 auto;
      margin: 0;
      border-style: solid; border-width: thin;
      border-left-color: #B0B0B0;
      border-right-color: #B0B0B0;
      border-bottom-color: #B0B0B0;
      border-top-color: transparent;
    }
    section#caption[dark] {
      background: #B0B0B0;
      color: #1d1d1d;
      border-left-color: #777;
      border-right-color: #777;
      border-bottom-color: #777;
    }
    section#caption span#captions {
      float: left;
      clear: both;
      padding: 0;
      margin: 0;
      font-weight: normal;
      font-size: 0.6em;
    }
    span#captions:first-child {
      font-weight: bold !important;
      font-size: 1em !important;
    }
    span#captions:nth-child(2) {
      font-size: 0.85em !important;
    }
    span#captions:nth-child(3) {
      font-size: 0.75em !important;
    }

    svg#icon {
      height: 1.5em;
      width: 1.5em;
      fill: currentColor;
      animation-name: exceed-animation;
      animation-duration: 2s;
      animation-timing-function: ease-in-out;
      animation-iteration-count: infinite;
    }
    @keyframes exceed-animation {
        0%   {transform: scale(1);}
        33%  {transform: scale(1.10);}
        100% {transform: scale(1);}
    }
    paper-ripple#ripple {
      color: #1d1d1d;
    }
    @media all and (max-width: 480px) {
      section#sign {
        min-width: 4em;
      }
    }
    @media all and (min-width: 600px) {
      :host[horizontal] {
        flex-direction: row;
      }
      section#sign[horizontal] {
        border-top-left-radius: inherit; border-top-right-radius: 0; border-bottom-left-radius: inherit; border-bottom-right-radius: 0;
        border-bottom-color: #B0B0B0;
        border-top-color: #B0B0B0;
        border-left-color: #B0B0B0;
        border-right-color: #BBB;
      }
      section#sign[dark][horizontal]{
        border-bottom-color: #777;
        border-top-color: #777;
        border-left-color: #777;
        border-right-color: #888;
      }
      section#caption[horizontal]{
        border-top-left-radius: 0; border-top-right-radius: inherit; border-bottom-left-radius: 0; border-bottom-right-radius: inherit;
        border-left-color: transparent;
        border-right-color: #B0B0B0;
        border-bottom-color: #B0B0B0;
        border-top-color: #B0B0B0;
      }
      section#caption[dark][horizontal] {
        border-right-color: #777;
        border-bottom-color: #777;
        border-top-color: #777;
      }
    }
    section#bookmark {
      cursor: pointer;
      -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;
      -webkit-touch-callout: none; -webkit-tap-highlight-color: rgba(0,0,0,0);
      display: inline-block;
      vertical-align: middle;
      text-align: center;
      font-size: 0.65em;
      padding: 0.35em;
      position: absolute;
      right: -0.1em;
      top: -0.1em;
      width: 1em;
      height: 1em;
      background: #EB4242;
      color: #f1f1f1;
      box-shadow: 0px 0px 1px #333;
      border-radius: 20%;
      transition: all 280ms ease;
      box-sizing: content-box;
    }
    section#bookmark:hover {
      transform: scale(1.5);
      border-radius: 50%;
      z-index: 150;
      background: #FF1818;
    }

    section#tooltip {
      position: absolute;
      left: calc(100% + 0.5em);
      top: -0.5em;
      transition: all 280ms ease;
      opacity: 1;
      visibility: visible;
      background: rgba(65,65,65,0.8);
      color: #f1f1f1;
      padding: 0.5em;
      border-radius: 2px;
      z-index: 150;
    }
    section#tooltip:not(.opened) {
      opacity: 0;
      visibility: hidden;
    }

  </style>
  <template>
      <section id="bookmark" hidden$="[[!hasExceeded]]" on-tap="_toggleTooltip">!</section>

      <section id="sign" horizontal$="[[horizontal]]" on-tap="_fireSelect" class="null">
        <paper-ripple id="ripple"></paper-ripple>

        <section id="actualValueSection">
          <template is="dom-if" if="[[!isBoolean]]" restamp>
            <section id="valueSection"></section><section id="unitSection">[[keys.unit]]</section>
          </template>
          <template is="dom-if" if="[[isBoolean]]" restamp>
            <svg id="icon" hidden$="[[!isExceeding]]" viewBox="0 0 24 24">
                <g id="error-outline"><path d="M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/></g>
            </svg>
          </template>
        </section>

        <section id="dateSection" hidden$="[[!showDate]]">
        </section>
      </section>

      <section id="caption" horizontal$="[[horizontal]]" hidden$="[[!showCaption]]">
        <template id="captiontemplate" is="dom-repeat" items="[[captionKeys]]" as="captionKey">
          <span id="captions" hidden$="[[isEmptyCaption(captionKey)]]">[[getKey(captionKey, keys.*)]]</span>
        </template>
      </section>

      <section id="tooltip" hidden$="[[!hasExceeded]]" on-tap="_hideToolTip">
        sdfsdfdfsdf
        sdfdsfsdf
      </section>

  </template>

  <script>

    SignElement = Polymer({
      is: 'sign-element',

      behaviors: [ElementBehavior],

      properties: {
        showDate: {
          type: Boolean,
          value: false,
          reflectToAttribute: true
        },
        horizontal: {
          type: Boolean,
          value: false,
          reflectToAttribute: true
        },
        showCaption: {
          type: Boolean,
          value: true,
          reflectToAttribute: true
        }
      },

      factoryImpl: function(element, bubbles, showDate) {
        this.setElement(element);
        if (showDate === false)
          this.showDate = false;
        if (bubbles === true)
          this.bubbles = true;
        if (dark) {
          this.setAttribute("dark", true);
          this.$.caption.setAttribute("dark", true);
          this.$.sign.setAttribute("dark", true);
        }
      },

      setExceedingState: function(isExceeding, state) {
        this.set('isExceeding', isExceeding);
        // set color of the sign
        this.$.sign.classList.remove('true');
        this.$.sign.classList.remove('false');
        this.$.sign.classList.remove('null');
        this.$.sign.classList.remove('undefined');
        this.$.sign.classList.add(state);
      },

      _updateView: function(value) {
        if (value === undefined) return;

        // set value
        if (!this.isBoolean)
          this.$.valueSection.textContent = value.y || ' ';

        // set date
        if (this.showDate)
          this.$.dateSection.textContent = new Date(value.x).toLocaleTimeString() || ' ';
      },

      _handleExceeding: function(isExceeding) {
        if(this.bubbles) {
          if (isExceeding)
            this.fire("element-is-exceeding", this.getElement());
          else
            this.fire("element-is-not-exceeding", this.getElement());
        }
      },

      _fireSelect: function(e) {
        this.fire("element-select", this.getElement());
        if (this.hasExceeded) this._hideToolTip();
      },

      _openTooltip: function() {
        if (!this.hasExceeded) return;
        this.$.tooltip.classList.add("opened");
      },

      _toggleTooltip: function() {
        if (!this.hasExceeded) return;
        if (this.$.tooltip.classList.contains("opened"))
          this.$.tooltip.classList.remove("opened");
        else
          this.$.tooltip.classList.add("opened");
      },

      _hideToolTip: function() {
        this.$.tooltip.classList.remove("opened");
      }

    });
  </script>

</dom-module>
