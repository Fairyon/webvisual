<dom-module id="table-element">
  <style>
    :host {
      overlay: hidden;
      display: block;
      color: currentColor;
      background: inherit;
    }
    table {
      display: block;
      width: 100%;
      height: 100%;
      border-collapse: collapse;
      text-align: center;
      font-size: 0.7em;
    }
    table thead {
      display: block;
      height: 2.5em;
      margin-right: 1em;
    }
    table thead tr{
      line-height: 2.5em;
      display: flex;
      align-items: center;
    }
    table tbody tr {
      line-height: 1.8em;
      display: flex;
      align-items: center;
    }
    table tbody {
      border-top: thin solid #8c8c8c;
      display: block;
      height: calc(100% - 2.5em);
      overflow-x: auto;
      overflow-y: scroll;
    }
    caption {
      font-family: Roboto-Condensed-Light-Italic;
      font-size: 1em;
    }
    th {
      font-family: Roboto;
      font-size: 1.1em;
    }
    td {
      font-family: Roboto-Condensed;
      font-size: 1em;
    }
    tr:hover {
      background-color: rgba(137, 137, 137, 0.25) !important;
    }
    th, td, caption {
      padding: 0em 1em;
      display: flex;
      white-space: nowrap;
      flex: 1;
    }
    tr#lastExceeds{
      border: thin solid #FF7E7E;
    }

  </style>
  <template>
    <table id="content">
      <template is="dom-if" if="{{showCaption}}" restamp>
        <caption>
          <span>{{element.roomNr}}</span><span>, </span>
          <span>{{element.room}}</span><span>, </span>
          <span>{{element.kind}}</span><span>, </span>
          <span>{{element.method}}</span>
        </caption>
      </template>
      <thead>
        <tr>
          <th id="xHead">Datum</th>
          <th id="yHead">Wert</th>
        </tr>
      </thead>
      <tbody>
        <template is="dom-if" if="{{showExceeds}}" restamp>
          <template is="dom-if" if="{{element.lastExceeds}}" restamp>
            <tr id="lastExceeds" style={{computeLastExceedsStyle()}}>
              <td>{{computeLastExceedsX()}}</td>
              <td>{{computeLastExceedsY()}}</td>
            </tr>
          </template>
        </template>
        <template is="dom-repeat" id="values" items="{{element.values}}" index-as="i">
          <tr style$={{computeStyle(element.values.*,i)}}>
            <td>{{computeX(element.values.*,i)}}</td>
            <td>{{computeY(element.values.*,i)}}</td>
          </tr>
        </template>
      </tbody>
    </table>
  </template>

  <script>

    Polymer({
      is: 'table-element',

      behaviors: [ScrollBehavior, LanguageBehavior, ElementBehavior],

      properties: {
        showCaption: {
          type: Boolean,
          notify: true,
          reflectToAttribute: true
        },
        showExceeds: {
          type: Boolean,
          notify: true,
          reflectToAttribute: true
        }
      },

      attached: function(){
        // this.$.xHead.innerText = this.getDescription('x');
        // this.$.yHead.innerText = this.getDescription('y');
      },

      computeStyle: function(change, index){
        var exceeds = this.get('exceeds', change.base[index]);
        if(exceeds == true)
          return "background: rgba(255, 21, 41,0.8); color: #f1f1f1;";
        else if(exceeds == false)
          return "background: rgba(255, 20, 110,0.8); color: #f1f1f1;";
        else if(exceeds == null)
          return "background: transparent; color: #1f1f1f;";
        else if(exceeds == null)
          return "background: rgba(236, 249, 97,0.8); color: #1f1f1f;";
      }
      // scrollHandler: function(e) {
      // }

    });

  </script>

</dom-module>
