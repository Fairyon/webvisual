<dom-module id="table-element">
  <style>
    :host {
      color: currentColor;
      display: inline-block;
      max-height: 30vh;
      overflow-x: hidden;
      overflow-y: scroll;
    }
    table {
      text-align: center;
      border-collapse: collapse;
      table-layout: fixed;
    }
    caption {
      font-family: Roboto-Condensed-Light-Italic;
      font-size: 0.9em;
    }
    th {
      font-family: Roboto;
    }
    td {
      font-family: Roboto-Condensed;
    }
    td, th {
      font-size: 0.9em;
    }
    tr:hover {
      background: rgba(137, 137, 137, 0.25);
    }
    th, td, caption {
      padding: 0.6em 1em;
    }
    thead {
      border-top: thin solid #8c8c8c;
      border-bottom: thin solid #8c8c8c;
    }
    tr#lastExceeds{
      border: thin solid #FF7E7E;
    }
  </style>
  <template>
    <table id="content">
      <template is="dom-if" if="{{showCaption}}">
        <caption>
          <span>[[element.roomNr]]</span><span>, </span>
          <span>[[element.room]]</span><span>, </span>
          <span>[[element.kind]]</span><span>, </span>
          <span>[[element.method]]</span>
        </caption>
      </template>
      <thead>
        <th>[[language.x]]</th>
        <th>[[language.y]]</th>
      </thead>
      <tbody>
        <template is="dom-if" if="[[element.lastExceeds]]">
          <tr id="lastExceeds" style=[[computeStyle(element.lastExceeds.exceeds)]]>
            <td>[[computeX(element.lastExceeds.x)]]</td>
            <td>[[computeY(element.lastExceeds.y,element.lastExceeds.exceeds)]]</td>
          </tr>
        </template>
        <template is="dom-repeat" id="values" items="[[element.values]]">
          <tr style=[[computeStyle(item.exceeds)]]>
            <td>[[computeX(item.x)]]</td>
            <td>[[computeY(item.y,item.exceeds)]]</td>
          </tr>
        </template>
      </tbody>
    </table>

    <!-- <array-selector id="selector" items="[[element.values]]" selected="[[selected]]" multi toggle></array-selector> -->
  </template>

  <script>

    Polymer({
      is: 'table-element',

      properties: {
          element: {
            type: Object,
            value: function() { return {"values":[]}; }
          },
          language: {
            type: Object,
            value: function() { return {'x':'Datum','y':'Wert'}; }
          },
          timeFormat: {
            type: String,
            value: "HH:mm:ss"
          },
          showCaption: {
            type: Boolean,
            notify: true,
            reflectToAttribute: true
          }
          // arrayItems:{
          //   type: Array,
          //   value: function() { return [0,1,2,3,4,5]; }
          // },

      },

      observers: [
          'limitPresent(element.values.splices)'
        ],

      listeners: {
        'scroll': 'scrollHandler'
      },

      limitPresent: function(changeRecord) {
        // changeRecord.splices.indexSplices.forEach(function(s) {
        //   s.removed.forEach(function(user) {
        //     console.log(user.x + ' was removed');
        //   });
        //   console.log(s.addedCount + ' users were added');
        // }, this);
      },

      arrayItem: function(change, index, path) {
        return this.get(path, change.base[index]);
      },

      computeX: function(date){
        if(date)
          return $.format.toBrowserTimeZone(date,this.timeFormat);
        else
          return undefined;
      },

      computeY: function(value,exceeds){
        if(!value && value !=0)
          return undefined;
        else if (this.element.isBoolean){
          if (exceeds==true || exceeds==false)
            return "✗";
          else
            return "✓";
        }
        else {
          return value + ' ' + this.element.unit;
        }
      },

      computeStyle: function(exceeds){
        if(exceeds == true)
          return "background: #e71506; color: #f1f1f1;";
        else if(exceeds == false)
          return "background: #c019da; color: #f1f1f1;";
        else
          return "";
      },

      scrollHandler: function(e) {
        // console.log(e);
      }

    });
  </script>

</dom-module>
