<link rel="import" href="behaviors/element-behavior.html">
<link rel="import" href="behaviors/scroll-behavior.html">
<link rel="import" href="behaviors/language-behavior.html">

<dom-module id="table-element">
  <style>
    :host {
      overlay: hidden;
      display: block;
      color: currentColor;
      background: inherit;
    }
    table {
      display: flex;
      width: 100%;
      height: 100%;
      border-collapse: collapse;
      text-align: center;
      font-size: 0.7em;
    }
    table thead {
      display: block;
      margin-right: 1em;
    }
    table thead tr{
      line-height: 2.5em;
    }
    tr {
      line-height: 1.8em;
      display: flex;
      align-items: center;
    }
    table tbody {
      border-top: thin solid #8c8c8c;
      display: block;
      height: calc(100% - 2.5em);
      overflow-x: auto;
      overflow-y: scroll;
    }
    caption {
      font-family: Roboto-Condensed-Light-Italic;
      font-size: 1em;
    }
    th {
      font-family: Roboto;
      font-size: 1.1em;
    }
    td {
      font-family: Roboto-Condensed;
      font-size: 1em;
    }
    tr:hover {
      background: rgba(137, 137, 137, 0.25);
    }
    th, td, caption {
      padding: 0em 1em;
      display: flex;
      white-space: nowrap;
      flex: 1;
    }
    tr#lastExceeds{
      border: thin solid #FF7E7E;
    }

  </style>
  <template>
    <table id="content">
      <template is="dom-if" if="{{showCaption}}" restamp>
        <caption>
          <span>[[element.roomNr]]</span><span>, </span>
          <span>[[element.room]]</span><span>, </span>
          <span>[[element.kind]]</span><span>, </span>
          <span>[[element.method]]</span>
        </caption>
      </template>
      <thead>
        <tr>
          <th id="xHead"></th>
          <th id="yHead"></th>
        </tr>
      </thead>
      <tbody>
        <template is="dom-if" if="{{showExceeds}}" restamp>
          <template is="dom-if" if="[[element.lastExceeds]]" restamp>
            <tr id="lastExceeds" style=[[computeStyle(element.lastExceeds.exceeds)]]>
              <td>[[computeX(element.lastExceeds.x)]]</td>
              <td>[[computeY(element.lastExceeds.y,element.lastExceeds.exceeds)]]</td>
            </tr>
          </template>
        </template>
        <template is="dom-repeat" id="values" items="[[element.values]]">
          <tr style$={{computeStyle(item.exceeds)}}>
            <td>[[computeX(item.x)]]</td>
            <td>[[computeY(item.y,item.exceeds)]]</td>
          </tr>
        </template>
      </tbody>
    </table>
  </template>

  <script>

    Polymer({
      is: 'table-element',

      behaviors: [ScrollBehavior, LanguageBehavior, ElementBehavior],

      properties: {
          showCaption: {
            type: Boolean,
            notify: true,
            reflectToAttribute: true
          },
          showExceeds: {
            type: Boolean,
            notify: true,
            reflectToAttribute: true
          }
      },

      attached: function(){
        this.$.xHead.innerText = this.getDescription('x');
        this.$.yHead.innerText = this.getDescription('y');
      },

      // listeners: {
      //   'scroll': 'scrollHandler'
      // },

      limitPresent: function(changeRecord) {
        // changeRecord.splices.indexSplices.forEach(function(s) {
        //   s.removed.forEach(function(user) {
        //     console.log(user.x + ' was removed');
        //   });
        //   console.log(s.addedCount + ' users were added');
        // }, this);
      },

      computeStyle: function(exceeds){
        if(exceeds == true)
          return "background: rgb(255, 21, 41); color: #f1f1f1;";
        else if(exceeds == false)
          return "background: rgb(255, 20, 110); color: #f1f1f1;";
        else
          return "background: transparent; color: #1f1f1f;";
      }
      // scrollHandler: function(e) {
      // }

    });

  </script>

</dom-module>
