<dom-module id="table-element">
  <style>
    :host {
      overlay: hidden;
      display: block;
      color: currentColor;
      background: inherit;
    }
    table {
      display: block;
      width: 100%;
      height: 100%;
      border-collapse: collapse;
      text-align: center;
      font-size: 0.7em;
    }
    table thead {
      display: block;
      height: 2.5em;
      margin-right: 1em;
    }
    table thead tr{
      line-height: 2.5em;
      display: flex;
      align-items: center;
    }
    table tbody tr {
      line-height: 1.8em;
      display: flex;
      align-items: center;
    }
    table tbody {
      border-top: thin solid #8c8c8c;
      display: block;
      height: calc(100% - 2.5em);
      overflow-x: auto;
      overflow-y: scroll;
    }
    caption {
      font-family: Roboto-Condensed-Light-Italic;
      font-size: 1em;
    }
    th {
      font-family: Roboto;
      font-size: 1.1em;
    }
    td {
      font-family: Roboto-Condensed;
      font-size: 1em;
    }
    tr:hover {
      background: rgba(137, 137, 137, 0.25);
    }
    th, td, caption {
      padding: 0em 1em;
      display: flex;
      white-space: nowrap;
      flex: 1;
    }
    tr#lastExceeds{
      border: thin solid #FF7E7E;
    }

  </style>
  <template>
    <table id="content">
      <!-- <template is="dom-if" if="{{showCaption}}" restamp>
        <caption>
          <span>{{element.roomNr}}</span><span>, </span>
          <span>{{element.room}}</span><span>, </span>
          <span>{{element.kind}}</span><span>, </span>
          <span>{{element.method}}</span>
        </caption>
      </template> -->
      <thead>
        <tr>
          <th id="xHead">Datum</th>
          <th id="yHead">Wert</th>
        </tr>
      </thead>
      <tbody>
        <!-- <template is="dom-if" if="{{showExceeds}}" restamp>
          <template is="dom-if" if="{{element.lastExceeds}}" restamp>
            <tr id="lastExceeds" style={{computeStyle(element.lastExceeds.exceeds)}}>
              <td>{{computeX(element.lastExceeds.x)}}</td>
              <td>{{computeY(element.lastExceeds.y,element.lastExceeds.exceeds)}}</td>
            </tr>
          </template>
        </template> -->
        <template is="dom-repeat" id="values" items="{{element.values}}" as="value">
          <tr style$={{computeStyle(value.exceeds)}}>
            <td>{{computeX(value.x)}}</td>
            <td>{{computeY(value.y,value.exceeds)}}</td>
          </tr>
        </template>
      </tbody>
    </table>
  </template>

  <script>

    Polymer({
      is: 'table-element',

      behaviors: [ScrollBehavior, LanguageBehavior],

      properties: {
          showCaption: {
            type: Boolean,
            notify: true,
            reflectToAttribute: true
          },
          showExceeds: {
            type: Boolean,
            notify: true,
            reflectToAttribute: true
          },

              element: {
                type: Object,
                value: function() { return {}; },
                notify: true
              },
              timeFormat: {
                type: String,
                value: "HH:mm:ss"
              }
          },

          firstX: function(change) {
            if (change.base && change.base.length != 0){
              var date = this.get('x', change.base[0]);
              return this.computeX(date);
            }
            else
              return undefined
          },

          firstY: function(change) {
            if (change.base && change.base.length != 0){
              var value = this.get('y', change.base[0]);
              var exceeds = this.get('exceeds', change.base[0]);
              return this.computeY(value, exceeds)
            }
            else
              return undefined;
          },

          firstStyle: function(change) {
            if (change.base && change.base.length != 0){
              var exceeds = this.get('exceeds', change.base[0]);
              return this.computeStyle(exceeds);
            }
            else
              return undefined;
          },

          firstIcon: function(change) {
            if (change.base && change.base.length != 0){
              var exceeds = this.get('exceeds', change.base[0]);
              if(exceeds == true || exceeds == false)
                return "error-outline";
              else
                return "";
            }
            else
              return undefined;
          },

          computeX: function(date){
            if(date)
              return $.format.toBrowserTimeZone(date,this.timeFormat);
          },

          computeY: function(value,exceeds){
            if(!value && value !=0)
              return undefined;
            else if (this.element.isBoolean){
              if (exceeds==true || exceeds==false)
                return "✗";
              else
                return "✓";
            }
            else {
              return value;
            }
          },

      attached: function(){
        // this.$.xHead.innerText = this.getDescription('x');
        // this.$.yHead.innerText = this.getDescription('y');
      },

      computeStyle: function(exceeds){
        if(exceeds == true)
          return "background: rgba(255, 21, 41,0.8); color: #f1f1f1;";
        else if(exceeds == false)
          return "background: rgba(255, 20, 110,0.8); color: #f1f1f1;";
        else
          return "background: transparent; color: #1f1f1f;";
      }
      // scrollHandler: function(e) {
      // }

    });

  </script>

</dom-module>
