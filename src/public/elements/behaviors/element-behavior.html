<script>
  ElementBehavior = {

    properties: {
        element: {
          type: Object,
          value: function() { return {}; },
          reflectToAttribute: true
        },
        label: {
          type: String,
          value: "",
          reflectToAttribute: true
        },
        id: {
          type: String,
          value: "",
          reflectToAttribute: true
        },
        keys: {
          type: Object,
          value: function() { return {}; },
          reflectToAttribute: true
        },
        values: {
          type: Array,
          value: function() { return []; }
        },
        captionKeys: {
          type: Array,
          value: function() { return []; },
          reflectToAttribute: true,
          observer: "_setAriaLabel"
        },
        isExceeding: {
          type: Boolean,
          value: false
        },
        captionStyle: {
          type: Array,
          value: function() {
            return [
              'font-weight: bold; font-size: 1em;',
              'font-weight: normal; font-size: 0.85em;',
              'font-weight: normal; font-size: 0.75em;',
              'font-weight: normal; font-size: 0.6em;'
            ];
          }
        }
    },

    observers:
      ["exceedStateChanged(element.isExceeding)"],

    exceedStateChanged: function(change) {
      // delegating state-change-event upwards
      switch (change) {
        case true:
          this.fire("element-is-exceeding", {element: this.element});
          break;
        case false:
          this.fire("element-is-not-exceeding", {element: this.element});
          break;
      }
    },

    getKey: function(key) {
      // if(this.element && this.element[key])
        return this.element.keys[key];
    },
    computeCaptionStyle: function(index) {
      if (this.captionStyle[index])
        return this.captionStyle[index];
      else
        return this.captionStyle[this.captionStyle.length - 1];
    },
    computeX: function(change, index){
      if (change.base && change.base.length != 0){
        var date = this.get('x', change.base[index]);
        if(date){
          return new Date(date).toLocaleTimeString();
        }
        else
          return ' ';
      }
    },
    computeY: function(change, index){
      if (change.base && change.base.length != 0){
        if (this.element.isBoolean){
          var exceeds = this.get('exceeds', change.base[index]);
          if (exceeds==true || exceeds==false)
            return '✗';
          else
            return '✓';
        }
        else {
          var value = this.get('y', change.base[index]);
          if ((value !== undefined) && (value !== ''))
            return value;
          else
            return ' ';
        }
      }
      else
        return ' ';
    },
    _setAriaLabel: function(){
      // this.setAttribute("aria-label", this.element.keys[this.captionKeys[0]])
    }
    // TODO: eventuell durch vorhandene obere Funktionen zu lösen
    // selector: name of the predicted element's values
    // e.g.: 'lastExceeds', 'firstExceeds'
  };
</script>
