<script>
  ElementBehavior = {

    properties: {
        label: {
          type: String,
          value: "",
          reflectToAttribute: true
        },
        id: {
          type: String,
          value: "",
          reflectToAttribute: true
        },
        keys: {
          type: Object,
          value: function() { return {}; },
          reflectToAttribute: true
        },
        captionKeys: {
          type: Array,
          value: function() { return []; },
          reflectToAttribute: true
        },
        values: {
          type: Array,
          value: function() { return []; }
        },
        firstExceeds: {
          type: Array,
          value: function() { return []; }
        },
        lastExceeds: {
          type: Array,
          value: function() { return []; }
        },
        isBoolean: {
          type: Boolean,
          value: false,
          reflectToAttribute: true
        },
        isExceeding: {
          type: Boolean,
          value: false
        },
        updatable: {
          type: Boolean,
          value: true,
          readOnly: true,
          reflectToAttribute: true
        },
        bubbles: {
          type: Boolean,
          value: false,
          reflectToAttribute: true
        }
    },

    observers: [
      "_handleExceeding(isExceeding)"
    ],

    getKey: function(key) {
      return this.keys[key];
    },

    setElement: function(element) {
      this.set('id', element.id);
      this.set('label', element.label);
      this.set('keys', element.keys);
      this.set('captionKeys', element.captionKeys);
      this.set('isBoolean', element.isBoolean);
      this.setValues(element.values);
    },

    getElement: function() {
      return {"id": this.id,
              "label": this.label,
              "keys": this.keys,
              "captionKeys": this.captionKeys,
              "isBoolean": this.isBoolean,
              "values": this.values};
    },

    unshiftValues: function(value) {
      this.unshift('values', value);

      if (value.exceeds === null) {
        if(this.isExceeding !== false) {
          this.setExceedingState(false);
          this.push("lastExceeds", this.values[1]);
        }
      }
      else if (value.exceeds === true || value.exceeds === false) {
        if(this.isExceeding === false) {
          this.setExceedingState(true);
          this.push("firstExceeds", this.values[0]);
        }
      }
      this._updateView(value);
    },

    spliceValues: function(start, end) {
      this.splice('values', start, end);
      this._updateView(undefined, {start: start, end: end});
    },

    setExceedingState: function(state) {
      this.set('isExceeding', state);
    },

    setValues: function(values, newestDataLast) {
      this.set('values', values);
      if (newestDataLast) {
        this.setExceedingState(values[values.length - 1].exceeds);
        this._updateView(values[values.length - 1]);
      }
      else {
        this.setExceedingState(values[0].exceeds);
        this._updateView(values[0]);
      }
    },

    _updateView: function(value, splices) {
    },

    _handleExceeding: function(isExceeding) {
      if(this.bubbles) {
        if (isExceeding)
          this.fire("element-is-exceeding", this.getElement());
        else
          this.fire("element-is-not-exceeding", this.getElement());
      }
    }

    // TODO: eventuell durch vorhandene obere Funktionen zu l√∂sen
    // selector: name of the predicted element's values
    // e.g.: 'lastExceeds', 'firstExceeds'
  };
</script>
