<script>
  ElementBehavior = {

    properties: {
        label: {
          type: String,
          value: "",
          reflectToAttribute: true
        },
        id: {
          type: String,
          value: "",
          reflectToAttribute: true
        },
        keys: {
          type: Object,
          value: function() { return {}; },
          reflectToAttribute: true
        },
        captionKeys: {
          type: Array,
          value: function() { return []; },
          reflectToAttribute: true
        },
        values: {
          type: Array,
          value: function() { return []; }
        },
        firstExceeds: {
          type: Array,
          value: function() { return []; }
        },
        lastExceeds: {
          type: Array,
          value: function() { return []; }
        },
        isBoolean: {
          type: Boolean,
          value: false,
          reflectToAttribute: true
        },
        svg: {
          type: Object,
          value: function() { return {}; },
          reflectToAttribute: true
        },
        exceedable: {
          type: Boolean,
          value: true,
          reflectToAttribute: true
        },
        isExceeding: {
          type: Boolean,
          value: false,
          observer: "_handleExceeding"
        },
        hasExceeded: {
          type: Boolean,
          value: false,
          observer: "_hasExceededChanged"
        },
        bubbles: {
          type: Boolean,
          value: false,
          reflectToAttribute: true
        },
        selectable: {
          type: Boolean,
          value: true,
          reflectToAttribute: true
        },
        updatable: {
          type: Boolean,
          value: true,
          readOnly: true,
          reflectToAttribute: true
        }
    },

    getKey: function(key) {
      return this.keys[key];
    },

    isEmptyCaption: function(key) {
      if (!this.keys[key]) return true;
      else return false;
    },

    setElement: function(element) {
      this.set('id', element.id);
      this.set('label', element.label);
      this.set('keys', element.keys);
      this.set('captionKeys', element.captionKeys);
      this.set('isBoolean', element.isBoolean);
      this.set('isExceeding', element.isExceeding);
      this.set('firstExceeds', element.firstExceeds);
      this.set('lastExceeds', element.lastExceeds);
      this.set('svg', element.svg);
      this.setValues(element.values);
    },

    getElement: function() {
      return {"id": this.id,
              "label": this.label,
              "keys": this.keys,
              "captionKeys": this.captionKeys,
              "isBoolean": this.isBoolean,
              "isExceeding": this.isExceeding,
              "svg": this.svg,
              "firstExceeds": this.firstExceeds,
              "lastExceeds": this.lastExceeds,
              "values": this.values};
    },

    unshiftValues: function(value) {
      this.unshift("values", value);

      if (value.exceeds === null) {
        if(this.isExceeding !== false) {
          this.setExceedingState(false, value.exceeds);
          this._setLastExceeds(this.values[1]);
        }
      }
      else if (value.exceeds === true || value.exceeds === false) {
        if(this.isExceeding === false) {
          this.setExceedingState(true, value.exceeds);
          this._setFirstExceeds(this.values[0]);
          if (this.hasExceeded === false)
            this.set("hasExceeded", true);
        }
      }
      this._updateView(value);
    },

    spliceValues: function(start, length) {
      this.values.splice(start, length);
      this._updateView(undefined, {start: start, length: length});
    },

    setExceedingState: function(isExceeding, state) {
      this.set('isExceeding', isExceeding);
    },

    _setFirstExceeds: function(value) {
      this.firstExceeds.push(value);
    },

    _setLastExceeds: function(value) {
      this.lastExceeds.push(value);
    },

    setValues: function(values, newestDataLast) {
      this.values = values;

      if (newestDataLast) {
        this.setExceedingState(values[values.length - 1].exceeds !== null, values[values.length - 1].exceeds);
        this._updateView(values[values.length - 1]);
      }
      else {
        this.setExceedingState(values[values.length - 1].exceeds !== null, values[0].exceeds);
        this._updateView(values[0]);
      }

      if (this.tooltip)
        this._setTooltip();
    },

    _updateView: function(value, splices) {
    },

    _handleExceeding: function(isExceeding) {
    },

    _hasExceededChanged: function() {
    },

    reset: function() {
      this.set("hasExceeded", false);
    }

    // TODO: eventuell durch vorhandene obere Funktionen zu l√∂sen
    // selector: name of the predicted element's values
    // e.g.: 'lastExceeds', 'firstExceeds'
  };
</script>
