<script>
  PageBehavior = {
    properties: {
      data: {
        type: Array,
        value: function() { return []; }
      },
      selectedElement: {
        type: Object,
        value: function() { return {}; }
      },
      selectedGroup: {
        type: Array,
        value: function() { return []; }
      },
      ids: {
        type: Array,
        value: function() { return []; }
      },
      labels: {
        type: Array,
        value: function() { return []; }
      },
      labelIndex: {
        type: Object,
        value: function() { return {}; }
      },
      groupingKeys: {
        type: Array,
        value: function() { return []; }
      },
      groups: {
        type: Array,
        value: function() { return []; }
      },
      preferedGroupingKeys: {
        type: Array,
        value: function() { return []; },
        notify: true
      },
      // selected Label (Tab index)
      selectedLabel: {
        type: Number,
        value: 0,
        notify: true
      },
      // selected LabelIndex (Array index of date)
      // important note: there is a difference because of initial selection order
      selectedLabelId: {
        type: Number,
        computed: '_computeSelectedLabelId(selectedLabel)',
        observer: '_selectedLabelChanged'
      },
      groupBy: {
        type: String,
        value: "all",
        observer: "setSelectedGroup"
      },
      maxTotalLines: {
        type: Number
      },
      interval: {
        type: Number
      }
    },
    observers: [
      "_labelsChanged(labels.length)"
    ],
    _labelsChanged: function(length) {
      // if(length > 0) {
      //   this.set("selectedLabel",0);
      // }
    },
    _computeSelectedLabelId: function(selectedLabel) {
      if (this.labels == undefined || this.labelIndex == undefined)
        return 0;
      else
        return this.labelIndex[this.labels[selectedLabel]];
    },
    _selectedLabelChanged: function() {
      this.setGroupBy(this.preferedGroupingKeys[this.selectedLabelId]);
      if(this.opened) {
        this.deselectElement();
      }
    },
    groupElements: function(item,group){
      if (group.name == "all")
        return true;
      else if (group.ids && group.ids.indexOf(item.id) != -1)
        return true;
      else
        return false;
    },
    setSelectedElement: function(e) {
    },
    deselectedElement: function(e) {
    },
    setGroupBy: function(groupBy) {
      if(groupBy && this.groupBy in this.groups[this.selectedLabelId]) {
        this.set("groupBy",groupBy);
        this.set("preferedGroupingKeys.#"+this.selectedLabelId, groupBy);
      }
      else if (this.preferedGroupingKeys && this.preferedGroupingKeys[this.selectedLabelId] && this.preferedGroupingKeys[this.selectedLabelId] in this.groups[this.selectedLabelId])
        this.set("groupBy",this.preferedGroupingKeys[this.selectedLabelId]);
      else
        this.set("groupBy","all");
    },
    setSelectedGroup: function(){
      // TODO: Handle lableid change too
      if(this.groups && this.groupBy && this.groups[this.selectedLabelId]){
        this.set("selectedGroup", this.groups[this.selectedLabelId][this.groupBy]);
        this.linkPaths("selectedGroup", "groups." + this.selectedLabelId + "." + this.groupBy);
      }
    },
    sortGroup: function(first,next){
      if (first.ids.length > next.ids.length)
        return true;
      else
        return false;
    }
  };
</script>
