<dom-module id="sign-page">
  <style>
    :host {
      margin: 0.5em;
    }
    paper-material {
      background: white;
      padding: 0em;
      border-radius: 3px;
      align-self: stretch;
    }
    paper-material.dark {
      background: #a8a8a8;
    }

    #content{
    }
    .inner {
      margin: 0em 0.55em 0.55em 0em;
    }
    .outer {
      margin: 0.5em;
    }
    paper-dialog#optionDialog {
      border-radius: 5px 5px 0px 0px;
      position: fixed;
      margin: 0em 0em;
      bottom: 0em;
      left: 1.5em;
      max-height: 38vh;
      width: calc(100vw - 3em);
    }

  </style>
  <template>
      <div id="content" class="horizontal layout start wrap">

        <template id="outerTemplate" is="dom-repeat" items="{{selectedGroup}}" as="groupedItem" sort="sortGroup">
          <post-card class="outer shadow-elevation-4dp" headline="{{groupedItem.group}}">

            <template id="innerTemplate" is="dom-repeat" items="{{data}}" as="element">
              <template is="dom-if" if="{{group(element,groupedItem)}}" restamp>
                <paper-material class="inner" elevation="1" class="vertical layout center">

                    <sign-element element="{{element}}"></sign-element>
                    <sign-caption element="{{element}}"></sign-caption>

                </paper-material>
              </template>
            </template>
          </post-card>
        </template>
      </div>

    <!-- Page-Options -->
    <paper-dialog id="optionDialog" entry-animation="slide-to-up-animation" exit-animation="slide-to-down-animation">
      <section class="vertical layout">
        <dropdown-selector items="[[groups.roomNr]]" label="Raumnummer"></dropdown-selector>
        <dropdown-selector items="[[groups.room]]" label="Raum"></dropdown-selector>
        <dropdown-selector items="[[groups.kind]]" label="Art"></dropdown-selector>
        <dropdown-selector items="[[groups.method]]" label="Methode"></dropdown-selector>
      </section>
    </paper-dialog>

  </template>

  <script>

    Polymer({
      is: 'sign-page',

      properties: {
          data: {
            type: Array,
            value: function() { return []; },
            notify: true
          },
          groups: {
            type: Object,
            value: function() { return {}; },
            notify: true
          },
          selectedGroup: {
            type: Array,
            value: function() { return []; },
            notify: true
          },
          groupedBy: {
            type: String,
            value: "roomNr",
            notify: true
          },
          isGrouping: {
            type: Boolean,
            value: false,
            notify: true
          },
          keys: {
            type: Array,
            value: function() { return ["kind","method","room","roomNr"]; }
          }
      },

      group: function(item,group){
        if (group.ids.indexOf(item.id) != -1)
          return true;
        else
          return false;
      },

      setGroup: function(){
        this.set("selectedGroup",this.groups[this.groupedBy]);
      },

      sortGroup: function(first,next){
        if (first.ids.length > next.ids.length)
          return true;
        else
          return false;
      },

      // observers: [
      //     'grouping(data.splices)'
      //   ],

      listeners: {
      },

      // datacheck: function(changeRecord) {
      //   if (changeRecord.path == 'data.splices') {
      //     console.log('array mutation')
      //   } else {
      //     console.log('non array mutation '+changeRecord.path+' '+changeRecord.value+' '+changeRecord.base)
      //   }
      // },

      ready: function(){
      },

      atGroup: function(item){
        return item.room == 'Gaslager';
      },

      sort: function(next,first){
        if (first > next)
        return -1;
        else return 1;
      },

      openOption: function(){
        this.$.optionDialog.open();
      },

      insertTable: function() {
        // var time = new Date();
        // var section = this.$.table;
        // for (var i=0; i < this.data.length; i++) {
        //   var table = document.createElement("table");
        //   for (var j=0; j < 2; j++) {
        //     var row = document.createElement("tr");
        //
        //     var td = document.createElement("td")
        //     td.innerHTML = this.data[i].room;
        //     row.appendChild(td);
        //
        //     var td = document.createElement("td")
        //     td.innerHTML = this.data[i].kind;
        //     row.appendChild(td);
        //
        //     var td = document.createElement("td")
        //     td.innerHTML = this.data[i].method;
        //     row.appendChild(td);
        //
        //     var td = document.createElement("td")
        //     var x = 2*i + j;
        //     td.innerHTML = x;
        //     row.appendChild(td);
        //
        //     table.appendChild(row);
        //   }
        //   section.appendChild(table);
        // }

        //   var tmp = [];
        //   for (i=0; i<this.data.length; i++) {
        //     for (j=0; j<this.data[i].data.length; j++) {
        //       tmp.push({"id":    this.data[i].id,
        //                 "room":  this.data[i].room,
        //                 "kind":  this.data[i].kind,
        //                 "method" :  this.data[i].method,
        //                 "unit":  this.data[i].unit,
        //                 "date":  this.data[i].data[j].date,
        //                 "value": this.data[i].data[j].value,
        //                 "exceeds": this.data[i].data[j].exceeds,
        //                 "color":  this.data[i].data[j].color});
        //     }
        //   }
        //   this.reduced = tmp;
        //
        // var timeafter = new Date();
        // time = timeafter - time;
        // console.log(time);
      },

      scrollHandler: function() {
        // var time = new Date();
        // var section = this.$.table;
        // for (var i=0; i < this.data.length; i++) {
        //   var table = document.createElement("table");
        //   for (var j=0; j < 1; j++) {
        //     var row = document.createElement("tr");
        //
        //     var td = document.createElement("td")
        //     td.innerHTML = this.data[i].room;
        //     row.appendChild(td);
        //
        //     var td = document.createElement("td")
        //     td.innerHTML = this.data[i].kind;
        //     row.appendChild(td);
        //
        //     var td = document.createElement("td")
        //     td.innerHTML = this.data[i].method;
        //     row.appendChild(td);
        //
        //     var td = document.createElement("td")
        //     var x = i + j;
        //     td.innerHTML = x;
        //     row.appendChild(td);
        //
        //     table.appendChild(row);
        //   }
        //   section.appendChild(table);
        // }
        // var timeafter = new Date();
        // time = timeafter - time;
        // console.log(time);
      }

    });
  </script>

</dom-module>
