<polymer-element name="value-sign">
  <template>
    <link rel="stylesheet" type='text/css' href="../css/elements/value-sign.css" />

    <template if="{{shadow}}">
      <paper-shadow id="shadow" z="1" fit animated>
    </template>
    <section class="main" vertical layout style="background: {{color}};">
      <template if="{{ripple}}">
        <paper-ripple id="ripple" class="fill" fit initialOpaciy="0.10"></paper-ripple>
      </template>
      <section class="valueSection" flex horizontal layout center center-justified>
          {{value}}
          <span class="unitSection">{{values.unit}}</span>
      </section>
      <template if={{showExceed}}>
        <section class="exceedsSection" horizontal layout center-justified>
          <div class="dateSection">{{exceedsDate}}</div>
          <div class="exceedsValueSection">{{exceedsValue}}</div>
        </section>
      </template>
    </section>
  </paper-shadow>
  </template>

  <script>
  Polymer('value-sign', {
      colorLow: 'linear-gradient(180deg, rgba(62, 20, 255, 0.85), rgba(62, 20, 255, 0.7), rgba(62, 20, 255, 0.85))',
      colorHigh: 'linear-gradient(180deg, rgba(255, 21, 41, 0.85), rgba(255, 21, 41, 0.7), rgba(255, 21, 41, 0.85))',
      colorNormal: 'linear-gradient(180deg, #f1f1f1, white, #f1f1f1)',
      publish: {
        shadow: false,
        showExceed: false,
        ripple: true,
        exceeds: null,
        exceedsDate: '',
        exceedsValue: '',
        color: 'linear-gradient(180deg, #f1f1f1, white, #f1f1f1)',
        values: { unit: '',
                  data: []
                  },
        value: 0
      },
      valuesChanged: function() {
        // values: shouldn't be to large and sorted (from latest to closest
        // value: last value in data-Array
        // exceeds: 'true' when over than the upper-limit, 'false' when lower than the lower-limit, 'null' when in range
        if (this.values) {
          this.value = this.values.data[this.values.data.length-1].value;
          this.resetExceeds();
          for (var i=this.values.data.length-1; i>=0; i--) {
            if (this.values.data[i].exceeds !== null) {
              this.exceeds = this.values.data[i].exceeds;
              this.exceedsDate = this.values.data[i].date;
              this.exceedsValue = "" + this.values.data[i].value + this.values.unit;
              break;
          }}
        }
      },
      exceedsChanged: function() {
        // exceeds falls back
        if (this.exceeds === null) this.color = this.colorNormal;
        else {
            // exceeds over limit
          if (this.exceeds === true) this.color = this.colorHigh;
            // exceeds under limit
          else if (this.exceeds === false) this.color = this.colorLow;
            // TODO: fire Event
        }
      },
      resetExceeds: function() {
        this.exceeds = null;
        this.exceedsDate = '';
        this.exceedsValue = '';
      }
  });
  </script>
</polymer-element>
