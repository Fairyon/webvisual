<link rel="import" href="../bower_components/polymer/polymer.html">
<link href="../bower_components/paper-ripple/paper-ripple.html" rel="import">

<polymer-element name="value-sign">
  <template>
    <style>
      [unresolved] {
        opacity: 0;
      }
      :host {
        position: relative;
        color: #1d1d1d;
        border-radius: 5px;
        overlay: hidden;
        display: flex;
        z-index: 0;
        outline: none;
        font-family: 'Roboto-Condensed-Light';
        background: transparent;
      }
      .main, #shadow {
        position: relative;
        border-radius: inherit;
        padding-top: 0.4em;
        padding-bottom: 0.4em;
        width: 100%
      }
      :hover {
        outline: thin solid #1d1d1d;
        background: rgba(0, 203, 40, 0.10);
      }
      .valueSection {
        padding-left: 0.15em;
        padding-right: 0.15em;
        font-size: 2.4em;
        font-style: normal;
        font-weight: 300;
        min-height: 100%;
      }
      .unitSection {
        padding-left: 0.3em;
        font-size: 0.4em;
        font-weight: 100;
      }
      .exceedsSection {
        padding: 0.2em 0.5em 0.2em;
        font-weight: 300;
        line-height: 0.8em;
      }
      .dateSection {
        font-style: italic;
        font-size: 0.7em;
      }
      .exceedsValueSection {
        padding-left: 0.5em;
        font-style: normal;
        font-size: 0.8em;
      }
    </style>

    <template if="{{shadow}}">
      <paper-shadow id="shadow" z="1" fit animated>
    </template>
    <section class="main" vertical layout style="background: {{color}};">
      <template if="{{ripple}}">
        <paper-ripple id="ripple" class="" initialOpacity="0.15" fit></paper-ripple>
      </template>
      <section class="valueSection" flex horizontal layout center center-justified>
          {{value}}
          <span class="unitSection">{{values.unit}}</span>
      </section>
      <template if={{showExceed}}>
        <section class="exceedsSection" horizontal layout center-justified>
          <div class="dateSection">{{exceedsDate}}</div>
          <div class="exceedsValueSection">{{exceedsValue}}</div>
        </section>
      </template>
    </section>
  </paper-shadow>
  </template>

  <script>
  Polymer('value-sign', {
      colorLow: 'linear-gradient(180deg, rgba(62, 20, 255, 0.85), rgba(62, 20, 255, 0.7), rgba(62, 20, 255, 0.85))',
      colorHigh: 'linear-gradient(180deg, rgba(255, 21, 41, 0.85), rgba(255, 21, 41, 0.7), rgba(255, 21, 41, 0.85))',
      colorNormal: 'linear-gradient(180deg, #f1f1f1, white, #f1f1f1)',
      publish: {
        shadow: false,
        showExceed: false,
        ripple: true,
        exceeds: null,
        exceedsDate: '',
        exceedsValue: '',
        color: 'linear-gradient(180deg, #f1f1f1, white, #f1f1f1)',
        values: { unit: '',
                  data: []
                  },
        value: 0
      },
      valuesChanged: function() {
        // values: shouldn't be to large and sorted (from latest to closest
        // value: last value in data-Array
        // exceeds: 'true' when over than the upper-limit, 'false' when lower than the lower-limit, 'null' when in range
        this.value = this.values.data[this.values.data.length-1].value;
        this.resetExceeds();
        if(this.values.data) {
          for (var i=this.values.data.length-1; i>=0; i--) {
            if (this.values.data[i].exceeds !== null) {
              this.exceeds = this.values.data[i].exceeds;
              this.exceedsDate = this.values.data[i].date;
              this.exceedsValue = "" + this.values.data[i].value + this.values.unit;
              break;
        }}}
      },
      exceedsChanged: function() {
          // exceeds over limit
        if (this.exceeds === true) this.color = this.colorHigh;
          // exceeds under limit
        else if (this.exceeds === false) this.color = this.colorLow;
          // exceeds falls back
        else if (this.exceeds === null) this.color = this.colorNormal;
      },
      resetExceeds: function() {
        this.exceeds = null;
      }
  });
  </script>
</polymer-element>
