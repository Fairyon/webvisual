<link rel="import" href="behaviors/page-behavior.html">
<link rel="import" href="behaviors/data-behavior.html">
<link rel="import" href="behaviors/scroll-behavior.html">
<link rel="import" href="behaviors/language-behavior.html">
<link rel="import" href="../components/neon-animation/neon-shared-element-animatable-behavior.html">

<dom-module id="selected-element-sign-page">
  <style>
    :host {
      font-family: Roboto;
      font-style: normal;
      display: flex;
      flex-direction: column;
      position: relative;
      width: 100%;
      height: 100%;
      z-index: 0;
    }

    main-toolbar: {
      overflow: hidden !important;
    }

    main-toolbar:after {
      position: absolute;
      height: 6px;
      bottom: -6px;
      box-shadow: inset 0px 5px 6px -3px rgba(0, 0, 0, 0.4);
      -webkit-transition: opacity 0.5s, -webkit-transform 0.5s;
      transition: opacity 0.5s, transform 0.5s;
      opacity: 0;
      content: "";
      width: 100%;
      left: 0px;
      right: 0px;
      z-index: 5;
      -webkit-transform: scale3d(1, 0, 1);
      -webkit-transform-origin: 0% 0%;
      transform: scale3d(1, 0, 1);
      transform-origin: 0% 0%;
    }

    main-toolbar.has-shadow:after {
      opacity: 1;
      -webkit-transform: scale3d(1, 1, 1);
      transform: scale3d(1, 1, 1);
    }

    #mainContent {
      display: flex;
      flex-wrap: wrap;
      align-content: flex-start;
      position: relative;
      overflow-y: auto;
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
      -ms-flex: 1 1 0.000000001px;
      -webkit-flex: 1;
      flex: 1;
      -webkit-flex-basis: 0.000000001px;
      flex-basis: 0.000000001px;
      background: #CCCCCC;
    }

    #mainContent.dark {
      background: #666666;
    }

    section.card {
      background: white;
      padding: 0em;
      border-radius: 2px 2px 2px 3px;
      margin: 0em 0.55em 0.55em 0em;
      border: thin solid lightgrey;
      border-radius: 2px;
      align-self: stretch;
    }
    section.card.dark {
      background: #a8a8a8;
      border: thin solid darkgrey;
    }
    section.caption {
      flex-direction: column;
      line-height: 1.4;
      display: flex;
      padding: 0.35em 0.65em 0.4em 0.6em;
    }
    #kind {
      font-family: Roboto-Bold;
      font-size: 1em;
    }
    #method {
      font-size: 0.75em;
    }
    #room {
      font-size: 0.9em;
    }
    #roomNr {
      font-size: 0.6em;
    }
    post-card.group > ::content #cardContent{
      padding: 0.5em 0em 0em 0.5em;
    }
    post-card.group {
      transition: box-shadow 0.28s cubic-bezier(0.4, 0, 0.2, 1);
      margin: 0.75em;
      box-shadow: 0 4px 5px 0 rgba(0, 0, 0, 0.14),
                  0 1px 10px 0 rgba(0, 0, 0, 0.12),
                  0 2px 4px -1px rgba(0, 0, 0, 0.4);
      align-self: baseline;
    }
    paper-dialog#optionDialog {
      border-radius: 5px 5px 0px 0px;
      position: fixed;
      margin: 0em 0em;
      bottom: 0em;
      max-height: 38vh;
      min-width: 40vw;
      max-width: calc(100vw - 3em);
    }
    section#lowerToolbar {
      display: flex;
    }
    section#lowerToolbar > #selectedElementSign {
      width: calc(32vh - 80px);
      min-width: 15vw;
      max-width: 30vw;
      border-radius: 1px 0px 0px 2px;
    }
    section#selectedElementCaption {
      color: #1f1f1f;
      background: white;
      border-radius: 0px 1px 2px 0px;
      padding-right: 1em;
      justify-content: center;
      line-height: 1.6;
    }
    section#selectedElementCaption.dark {
      background: #a8a8a8;
    }
    .selectedElement {
      font-size: 2.5vh;
      box-shadow: inset  0 2px -3px 0 rgba(0, 0, 0, 0.14),
                  0 2px 4px -1px rgba(0, 0, 0, 0.4);
    }
  </style>

  <template>
    <main-toolbar id="toolbar" class="has-shadow paper-header" opened>
        <paper-icon-button icon="menu" class="mainmenu header" on-click="toggleDrawer"></paper-icon-button>
        <logo-element class="header"></logo-element>
        <paper-icon-button id="iconToggle" class="icon-toggle" icon="expand-less" on-click="_onClose"></paper-icon-button>
        <section id="lowerToolbar">
          <sign-element id="selectedElementSign" class="selectedElement" element="[[selectedElement]]" on-click="_onClose"></sign-element>
          <section id="selectedElementCaption" class="selectedElement caption">
            <span id="kind">[[selectedElement.kind]]</span>
            <span id="method">[[selectedElement.method]]</span>
            <span id="room">[[selectedElement.room]]</span>
            <span id="roomNr">[[selectedElement.roomNr]]</span>
          </section>
          <table-element element="[[selectedElement]]"></table-element>
        </section>
    </main-toolbar>

    <section id="mainContent">
      <template id="groupingtemplate" is="dom-repeat" items="{{selectedGroup}}" as="groupedItem" sort="sortGroup">
        <post-card class="group" headline="[[groupedItem.group]]">

          <template id="elementlist" is="dom-repeat" items="{{data}}" as="element">
            <template is="dom-if" if="[[groupElements(element,groupedItem)]]" restamp>
              <section class="card" on-click="setSelectedElement">

                  <sign-element element="[[element]]"></sign-element>
                  <section class="caption" id="[[element.id]]">
                    <span id="kind">[[element.kind]]</span>
                    <span id="method">[[element.method]]</span>
                    <span id="room">[[element.room]]</span>
                    <span id="roomNr">[[element.roomNr]]</span>
                  </section>

              </section>
            </template>
          </template>
        </post-card>
      </template>


      <array-selector id="selector" items="{{data}}" selected="{{selectedElement}}"></array-selector>

    </section>

    <!-- Page-Options -->
    <paper-dialog id="optionDialog" entry-animation="slide-to-up-animation" exit-animation="slide-to-down-animation">
      <section class="horizontal layout">
        <post-card headline="Gruppieren nach">
          <paper-menu attr-for-selected="id" selected="{{groupBy}}">
            <template is="dom-repeat" items="{{keys}}" as="key">
              <paper-item id="[[key]]">[[key]]</paper-item>
            </template>
          </paper-menu>
        </post-card>
      </section>
    </paper-dialog>

  </template>

  <script>

    Polymer({
      is: 'selected-element-sign-page',

      behaviors: [ScrollBehavior, DataBehavior, LanguageBehavior, PageBehavior, Polymer.NeonSharedElementAnimatableBehavior],

      properties: {
        sharedElements: {
          value: function() {
            return {
              'heroSign': this.$.selectedElementSign,
              'heroCaption': this.$.selectedElementCaption
            }
          }
        },
        animationConfig: {
          value: function() {
            return {
              'entry': [
                {
                  name: 'hero-animation',
                  id: 'heroSign',
                  toPage: this
                },
                {
                  name: 'hero-animation',
                  id: 'heroCaption',
                  toPage: this
                }
              ],
              'exit': [ {
                  name: 'fade-out-animation',
                  node: this.$.lowerToolbar,
                  timing: {
                    duration: 500
                  }
                },
                {
                  name: 'fade-out-animation',
                  node: this.$.iconToggle,
                  timing: {
                    duration: 250
                  }
                },
                {
                  name: 'height-animation',
                  node: this.$.toolbar,
                  height: "64px",
                }]
            }
          }
        }
      },

      _onClose: function(opened){
        this.fire("deselectedevent");
      },

      setSelectedElement: function(e) {
        if (e){
          if (this.selectedElement == e.model.element)
            this._onClose();
          else {
            this.$.selector.select(e.model.element);
          }
        }
      }

    });

  </script>

</dom-module>
