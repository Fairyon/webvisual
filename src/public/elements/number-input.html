<link rel="import" href="../components/paper-input/paper-input-behavior.html">
<link rel="import" href="../components/paper-input/paper-input-error.html">
<link rel="import" href="addons/number-input-unit.html">
<link rel="import" href="addons/number-validate.html">

<dom-module id="number-input">

  <style>

    :host {
      display: inline-block;
      font: inherit;
      outline: none;
      box-shadow: none;
      border: none;
      width: 100%;
      text-align: center;
    }

    paper-input-container {
      width: auto;
    }

  </style>

  <template>
    <number-validate minvalue="[[minvalue]]" maxvalue="[[maxvalue]]"></number-validate>
    <paper-input-container always-float-label auto-validate invalid="[[invalid]]">
      <label>[[label]]</label>
      <input is="iron-input"
        bind-value="{{value}}"
        invalid="{{invalid}}"
        type="number"
        inputmode="number"
        prevent-invalid-input
        minlength="1"
        maxlength="[[maxlength]]"
        validator="number-validate">
      <paper-input-error>[[errorMessage]]</paper-input-error>
      <number-input-unit unit="[[unit]]"></number-input-unit>
    </paper-input-container>
  </template>

  <script>
    Polymer({

      is: 'number-input',

      behaviors: [
        Polymer.PaperInputBehavior
      ],

      properties: {
        value: {
          type: Number,
          value: this.default,
          notify: true
        },
        maxvalue: {
          type: Number,
          value: 5000,
          notify: true
        },
        minvalue: {
          type: Number,
          value: 1,
          notify: true
        },
        maxlength: {
          type: Number,
          computed: "maxLengthChanged(maxValue)"
        },
        errorMessage: {
          type: String,
          value: "Ung√ºltige Eingabe!",
          notify: true
        },
        default: {
          type: Number,
          value: 10
        },
        unit: {
          type: String,
          value: "",
          notify: true
        }
      },

      ready: function(){
        this.value = this.default;
      },

      inputChanged: function(event){
        if (event.keyCode == 13){
          newValue = parseInt(this.input);
          if (newValue != NaN && newValue <= this.maxValue && newValue >= this.minValue){
            this.value = newValue;
          }
          this.input = this.value;
          this.fire("input-changed");
        }
      },

      maxLengthChanged: function(max){
        var str = max.toString();
        return str.length;
      }
    });
  </script>

</dom-module>
